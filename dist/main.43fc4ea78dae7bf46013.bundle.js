(()=>{"use strict";var e,t={189:(e,t,i)=>{var s,a,h,l,n,o,r,d,c,p;i(260),i(127);class m extends Phaser.Physics.Arcade.Sprite{constructor(e,t,i,s){super(e,t,i,s),e.add.existing(this),e.physics.add.existing(this),this.setCollideWorldBounds(!0).setBounce(.6).setInteractive().on("pointerdown",(()=>{this.setVelocityY(-400)}))}}class u extends Phaser.Scene{constructor(){super({key:"SplashScene"}),this.timedEvents=[]}preload(){}create(){let{width:e,height:t}=this.sys.game.canvas;this.screenX=e,this.screenY=t,this.backingMusic=this.sound.add("splash_screen_track",{loop:!0}),this.backingMusic.play(),this.logo=new m(this,this.cameras.main.width/2,0,"truffles_splash"),this.timedEvents.push(this.time.delayedCall(4500,this.onEventLogo,["the_hunt_museum"],this)),this.timedEvents.push(this.time.delayedCall(5500,this.onEventLogo,["limerick_museum"],this)),this.timedEvents.push(this.time.delayedCall(6500,this.onEventLogo,["limerick_gallery_of_art"],this)),this.timedEvents.push(this.time.delayedCall(7500,this.onEventLogo,["SETU_Ireland_logo"],this)),this.timedEvents.push(this.time.delayedCall(8500,this.onEventGame,[],this))}update(e,t){}onEventLogo(e){this.logo.destroy(),this.logo=new m(this,this.cameras.main.width/2,0,e)}onEventGame(){this.logo.destroy(),this.scene.start("LEVEL_01"),this.backingMusic.stop()}}class y extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.image("truffles_splash","assets/splash/splash.png"),this.load.image("artifact_scene_background","assets/artifacts/img/background.png"),this.load.image("the_hunt_museum","assets/logos/the_hunt_museum.png"),this.load.image("limerick_museum","assets/logos/limerick_city.png"),this.load.image("limerick_gallery_of_art","assets/logos/LCGA.png"),this.load.image("SETU_Ireland_logo","assets/logos/SETU_Ireland_computing.png"),this.load.audio("church_bells",["assets/audio/level/church_bells.mp3","assets/audio/level/church_bells.ogg"]),this.load.audio("splash_screen_track",["assets/audio/splash/splash_screen_track.mp3","assets/audio/splash/splash_screen_track.ogg"]),this.load.audio("level_backing_track",["assets/audio/level/level_backing_track.mp3","assets/audio/level/level_backing_track.ogg"]),this.load.audio("reward",["assets/audio/level/reward.mp3","assets/audio/level/reward.ogg"]),this.load.audio("punish_one",["assets/audio/level/punish_one.mp3","assets/audio/level/punish_one.ogg"]),this.load.audio("punish_two",["assets/audio/level/punish_two.mp3","assets/audio/level/punish_two.ogg"]),this.load.audio("revived",["assets/audio/level/revived.mp3","assets/audio/level/revived.ogg"]),this.load.audio("under_attack",["assets/audio/level/under_attack.mp3","assets/audio/level/under_attack.ogg"]),this.load.audio("reached_goal",["assets/audio/level/reached_goal.mp3","assets/audio/level/reached_goal.ogg"]),this.load.audio("a_boy_the_kid",["assets/audio/idioms/a_boy_the_kid.mp3","assets/audio/idioms/a_boy_the_kid.ogg"]),this.load.audio("come_here_i_want_ya",["assets/audio/idioms/come_here_i_want_ya.mp3","assets/audio/idioms/come_here_i_want_ya.ogg"]),this.load.audio("decent",["assets/audio/idioms/decent.mp3","assets/audio/idioms/decent.ogg"]),this.load.audio("dose",["assets/audio/idioms/dose.mp3","assets/audio/idioms/dose.ogg"]),this.load.audio("gawke",["assets/audio/idioms/gawke.mp3","assets/audio/idioms/gawke.ogg"]),this.load.audio("head_like_a_chewed_toffee",["assets/audio/idioms/head_like_a_chewed_toffee.mp3","assets/audio/idioms/head_like_a_chewed_toffee.ogg"]),this.load.audio("mup",["assets/audio/idioms/mup.mp3","assets/audio/idioms/mup.ogg"]),this.load.audio("sca",["assets/audio/idioms/sca.mp3","assets/audio/idioms/sca.ogg"]),this.load.audio("shades",["assets/audio/idioms/shades.mp3","assets/audio/idioms/shades.ogg"]),this.load.audio("sham",["assets/audio/idioms/sham.mp3","assets/audio/idioms/sham.ogg"]),this.load.audio("silent",["assets/audio/idioms/silent.mp3","assets/audio/idioms/silent.ogg"]),this.load.audio("state_of_ya",["assets/audio/idioms/state_of_ya.mp3","assets/audio/idioms/state_of_ya.ogg"]),this.load.audio("story",["assets/audio/idioms/story.mp3","assets/audio/idioms/story.ogg"]),this.load.audio("tackies",["assets/audio/idioms/tackies.mp3","assets/audio/idioms/tackies.ogg"]),this.load.audio("took_a_hopper",["assets/audio/idioms/took_a_hopper.mp3","assets/audio/idioms/took_a_hopper.ogg"]),this.load.audio("unreal",["assets/audio/idioms/unreal.mp3","assets/audio/idioms/unreal.ogg"]),this.load.audio("well_boi_whats_the_craic",["assets/audio/idioms/well_boi_whats_the_craic.mp3","assets/audio/idioms/well_boi_whats_the_craic.ogg"]),this.load.audio("well_kid",["assets/audio/idioms/well_kid.mp3","assets/audio/idioms/well_kid.ogg"]),this.load.audio("well_sham_any_sca",["assets/audio/idioms/well_sham_any_sca.mp3","assets/audio/idioms/well_sham_any_sca.ogg"]),this.load.audio("yurt",["assets/audio/idioms/yurt.mp3","assets/audio/idioms/yurt.ogg"])}create(){this.scene.start("SplashScene")}}class g extends Phaser.GameObjects.Text{constructor(e){super(e,10,50,"",{color:"#EC00D7",fontSize:"48px",fontFamily:"gamefont"}),e.add.existing(this),this.setOrigin(.5)}update(){this.setText("0")}}class L extends Phaser.Scene{constructor(){super({key:"ArtiFactOneScene"})}preload(){this.load.script("fractals","https://static.sketchfab.com/api/sketchfab-viewer-1.12.0.js"),this.load.html("artifact_one","assets/artifacts/artifact_one.html")}create(){let{width:e,height:t}=this.sys.game.canvas;this.background=this.add.image(e/2,t/2,"artifact_scene_background"),this.background.setDisplaySize(e,t),this.background.setOrigin(.5,.5),this.element=this.add.dom(this.cameras.main.width/2,100).createFromCache("artifact_one"),this.backingMusic=this.sound.add("splash_screen_track",{loop:!0}),this.backingMusic.play(),this.nextLevel=new g(this),this.nextLevel.setShadow(3,3),this.nextLevel.setStroke("#fff",16),this.nextLevel.setShadow(2,2,"#333333",2,!0,!0),this.nextLevel.setPosition(.25*e,.8*t),this.nextLevel.on("pointerdown",(()=>this.onClickNextLevel()))}update(){this.nextLevel.update(),this.nextLevel.setText("Next Level"),this.nextLevel.setInteractive()}onClickNextLevel(){this.backingMusic.stop(),this.scene.start("LEVEL_02")}}class T extends Phaser.Scene{constructor(){super({key:"ArtiFactTwoScene"})}preload(){this.load.script("fractals","https://static.sketchfab.com/api/sketchfab-viewer-1.12.0.js"),this.load.html("artifact_two","assets/artifacts/artifact_two.html")}create(){let{width:e,height:t}=this.sys.game.canvas;this.background=this.add.image(e/2,t/2,"artifact_scene_background"),this.background.setDisplaySize(e,t),this.background.setOrigin(.5,.5),this.element=this.add.dom(this.cameras.main.width/2,100).createFromCache("artifact_two"),this.backingMusic=this.sound.add("splash_screen_track",{loop:!0}),this.backingMusic.play(),this.nextLevel=new g(this),this.nextLevel.setShadow(3,3),this.nextLevel.setStroke("#fff",16),this.nextLevel.setShadow(2,2,"#333333",2,!0,!0),this.nextLevel.setPosition(.25*e,.8*t),this.nextLevel.on("pointerdown",(()=>this.onClickNextLevel()))}update(){this.nextLevel.update(),this.nextLevel.setText("Next Level"),this.nextLevel.setInteractive()}onClickNextLevel(){this.backingMusic.stop(),this.scene.start("LEVEL_03")}}class _ extends Phaser.Scene{constructor(){super({key:"ArtiFactThreeScene"})}preload(){this.load.script("fractals","https://static.sketchfab.com/api/sketchfab-viewer-1.12.0.js"),this.load.html("artifact_three","assets/artifacts/artifact_three.html")}create(){let{width:e,height:t}=this.sys.game.canvas;this.background=this.add.image(e/2,t/2,"artifact_scene_background"),this.background.setDisplaySize(e,t),this.background.setOrigin(.5,.5),this.element=this.add.dom(this.cameras.main.width/2,100).createFromCache("artifact_three"),this.backingMusic=this.sound.add("splash_screen_track",{loop:!0}),this.backingMusic.play(),this.nextLevel=new g(this),this.nextLevel.setShadow(3,3),this.nextLevel.setStroke("#fff",16),this.nextLevel.setShadow(2,2,"#333333",2,!0,!0),this.nextLevel.setPosition(.25*e,.8*t),this.nextLevel.on("pointerdown",(()=>this.onClickNextLevel()))}update(){this.nextLevel.update(),this.nextLevel.setText("Next Level"),this.nextLevel.setInteractive()}onClickNextLevel(){this.backingMusic.stop(),this.scene.start("LEVEL_04")}}class w extends Phaser.Scene{constructor(){super({key:"ArtiFactFourScene"})}preload(){this.load.script("fractals","https://static.sketchfab.com/api/sketchfab-viewer-1.12.0.js"),this.load.html("artifact_four","assets/artifacts/artifact_four.html")}create(){let{width:e,height:t}=this.sys.game.canvas;this.background=this.add.image(e/2,t/2,"artifact_scene_background"),this.background.setDisplaySize(e,t),this.background.setOrigin(.5,.5),this.element=this.add.dom(this.cameras.main.width/2,100).createFromCache("artifact_four"),this.backingMusic=this.sound.add("splash_screen_track",{loop:!0}),this.backingMusic.play(),this.nextLevel=new g(this),this.nextLevel.setShadow(3,3),this.nextLevel.setStroke("#fff",16),this.nextLevel.setShadow(2,2,"#333333",2,!0,!0),this.nextLevel.setPosition(.25*e,.8*t),this.nextLevel.on("pointerdown",(()=>this.onClickNextLevel()))}update(){this.nextLevel.update(),this.nextLevel.setText("Next Level"),this.nextLevel.setInteractive()}onClickNextLevel(){this.backingMusic.stop(),this.scene.start("Credits")}}!function(e){e.PLAY="play",e.LEVEL_COMPLETE="level_complete",e.GAME_COMPLETE="game_complete"}(s||(s={})),function(e){e.CURRENT="level_current",e.NEXT="level_next",e.CURRENT_ARTIFACT="artifact_current",e.NEXT_ARTIFACT="artifact_next"}(a||(a={})),function(e){e.LEVEL_01="LEVEL_01",e.LEVEL_02="LEVEL_02",e.LEVEL_03="LEVEL_03",e.LEVEL_04="LEVEL_04",e.CREDITS="Credits"}(h||(h={})),function(e){e.ArtiFactOneScene="ArtiFactOneScene",e.ArtiFactTwoScene="ArtiFactTwoScene",e.ArtiFactThreeScene="ArtiFactThreeScene",e.ArtiFactFourScene="ArtiFactFourScene",e.CREDITS="Credits"}(l||(l={})),function(e){e[e.TILE=551]="TILE"}(n||(n={})),function(e){e[e.ORANGE=0]="ORANGE",e[e.ORANGE_TILE=555]="ORANGE_TILE",e[e.LEMON=1]="LEMON",e[e.LEMON_TILE=503]="LEMON_TILE",e[e.GRAPE=2]="GRAPE",e[e.GRAPE_TILE=607]="GRAPE_TILE"}(o||(o={})),function(e){e[e.START=500]="START",e[e.END=552]="END",e[e.SPEED=.5]="SPEED",e[e.SCALE=.2]="SCALE"}(r||(r={})),function(e){e.WALK_DOWN="walk_front",e.WALK_UP="walk_back"}(d||(d={}));class S extends Phaser.Scene{constructor(){super({key:"Credits"})}preload(){this.load.script("fractals","https://static.sketchfab.com/api/sketchfab-viewer-1.12.0.js"),this.load.html("credits","assets/credits/credits.html")}create(){let{width:e,height:t}=this.sys.game.canvas;this.background=this.add.image(e/2,t/2,"artifact_scene_background"),this.background.setDisplaySize(e,t),this.background.setOrigin(.5,.5),this.element=this.add.dom(this.cameras.main.width/2,100).createFromCache("credits"),this.backingMusic=this.sound.add("splash_screen_track",{loop:!0}),this.backingMusic.play(),this.nextLevel=new g(this),this.nextLevel.setShadow(3,3),this.nextLevel.setStroke("#fff",16),this.nextLevel.setShadow(2,2,"#333333",2,!0,!0),this.nextLevel.setPosition(.25*e,.8*t),this.nextLevel.on("pointerdown",(()=>this.onClickNextLevel()))}update(){this.nextLevel.update(),this.nextLevel.setText("Replay"),this.nextLevel.setInteractive()}onClickNextLevel(){window.localStorage.setItem(a.CURRENT,h.LEVEL_01),this.backingMusic.stop(),window.location.reload(),this.scene.start("PreloadScene")}}(p=c||(c={})).IDLE="idle",p.WALK_RIGHT="walk_right",p.WALK_LEFT="walk_left",p.WALK_UP="walk_up",p.WALK_DOWN="walk_down",p.UNDER_ATTACK="under_attack",p.EATING="eating",p.EATING_RIGHT="eating_right",p.EATING_LEFT="eating_left",p.EATING_UP="eating_up",p.EATING_DOWN="eating_down",p.MUNCHING_LEFT="munching_left",p.MUNCHING_RIGHT="munching_right",p.MUNCHING_UP="munching_up",p.MUNCHING_DOWN="munching_down",p.EXPIRED="expired",p.REVIVE="revive",p.REVIVED="revived",p.SPLASH="splash",p.REACHED_GOAL="revived";class v{constructor(e,t){this.scene=e,this.spine=t,this.idiomPlayed=!1}}class f extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.WALK_RIGHT?new b(this.scene,this.spine):e===c.WALK_LEFT?new E(this.scene,this.spine):e===c.WALK_UP?new A(this.scene,this.spine):e===c.WALK_DOWN?new I(this.scene,this.spine):e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):e===c.REACHED_GOAL?new V(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!1),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 3:case 5:case 6:case 8:case 9:case 11:case 12:case 14:case 16:case 17:case 19:case 20:default:this.idiomSound=this.scene.sound.add("silent");break;case 2:this.idiomSound=this.scene.sound.add("story");break;case 4:case 10:case 15:this.idiomSound=this.scene.sound.add("well_sham_any_sca");break;case 7:this.idiomSound=this.scene.sound.add("sca");break;case 13:this.idiomSound=this.scene.sound.add("a_boy_the_kid");break;case 18:this.idiomSound=this.scene.sound.add("decent")}this.spine.play(c.IDLE,!0)}update(e,t,i){this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.animationTime=0,this.idiomTime=0}}class b extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.IDLE?new f(this.scene,this.spine):e===c.WALK_LEFT?new E(this.scene,this.spine):e===c.WALK_UP?new A(this.scene,this.spine):e===c.WALK_DOWN?new I(this.scene,this.spine):e===c.EATING?new P(this.scene,this.spine):e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):e===c.REACHED_GOAL?new V(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!0),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 2:case 4:case 6:case 7:case 8:case 10:default:this.idiomSound=this.scene.sound.add("silent");break;case 3:case 5:case 9:this.idiomSound=this.scene.sound.add("unreal")}this.spine.play(c.WALK_RIGHT,!0)}update(e,t,i){this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.animationTime=0,this.idiomTime=0}}class E extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.IDLE?new f(this.scene,this.spine):e===c.WALK_RIGHT?new b(this.scene,this.spine):e===c.WALK_UP?new A(this.scene,this.spine):e===c.WALK_DOWN?new I(this.scene,this.spine):e===c.EATING?new D(this.scene,this.spine):e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):e===c.REACHED_GOAL?new V(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!0),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 7:this.idiomSound=this.scene.sound.add("gawke");break;default:this.idiomSound=this.scene.sound.add("silent")}this.spine.play(c.WALK_LEFT,!0)}update(e,t,i){this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.animationTime=0,this.idiomTime=0}}class A extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.IDLE?new f(this.scene,this.spine):e===c.WALK_LEFT?new E(this.scene,this.spine):e===c.WALK_RIGHT?new b(this.scene,this.spine):e===c.WALK_DOWN?new I(this.scene,this.spine):e===c.EATING?new k(this.scene,this.spine):e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):e===c.REACHED_GOAL?new V(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!0),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 5:case 9:this.idiomSound=this.scene.sound.add("yurt");break;default:this.idiomSound=this.scene.sound.add("silent")}this.spine.play(c.WALK_UP,!0)}update(e,t,i){this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.animationTime=0,this.idiomTime=0}}class I extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.IDLE?new f(this.scene,this.spine):e===c.WALK_LEFT?new E(this.scene,this.spine):e===c.WALK_RIGHT?new b(this.scene,this.spine):e===c.WALK_UP?new A(this.scene,this.spine):e===c.EATING?new N(this.scene,this.spine):e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):e===c.REACHED_GOAL?new V(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!0),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 2:case 3:case 4:case 6:case 8:case 9:case 10:default:this.idiomSound=this.scene.sound.add("silent");break;case 5:case 7:this.idiomSound=this.scene.sound.add("yurt")}this.spine.play(c.WALK_DOWN,!0)}update(e,t,i){this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.animationTime=0,this.idiomTime=0}}class D extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!1),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 5:case 7:case 9:this.idiomSound=this.scene.sound.add("well_kid");break;default:this.idiomSound=this.scene.sound.add("silent")}this.spine.play(c.EATING_LEFT,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>=i.getEatingDelay()){i.getState();let h=new x(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.idiomElapsed=0,this.idiomTime=0}}class x extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!1),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 5:case 7:this.idiomSound=this.scene.sound.add("unreal");break;default:this.idiomSound=this.scene.sound.add("silent")}this.rewardSound=this.scene.sound.add("reward",{volume:.5}),this.rewardSound.play(),this.spine.play(c.MUNCHING_LEFT,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>i.getMunchingDelay()){i.getState();let h=new f(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.idiomElapsed=0,this.idiomTime=0}}class P extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!1),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 2:case 4:case 5:case 6:case 8:case 10:default:this.idiomSound=this.scene.sound.add("silent");break;case 3:case 7:case 9:this.idiomSound=this.scene.sound.add("come_here_i_want_ya")}this.spine.play(c.EATING_RIGHT,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>=i.getEatingDelay()){i.getState();let h=new R(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.idiomElapsed=0,this.idiomTime=0}}class R extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!1),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 2:case 4:case 6:case 7:case 8:case 10:default:this.idiomSound=this.scene.sound.add("silent");break;case 3:case 5:case 9:this.idiomSound=this.scene.sound.add("unreal")}this.rewardSound=this.scene.sound.add("reward",{volume:.5}),this.rewardSound.play(),this.spine.play(c.MUNCHING_RIGHT,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>i.getMunchingDelay()){i.getState();let h=new f(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.idiomElapsed=0,this.idiomTime=0}}class k extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!1),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 2:case 4:case 6:case 7:case 8:case 10:default:this.idiomSound=this.scene.sound.add("silent");break;case 3:case 5:case 9:this.idiomSound=this.scene.sound.add("come_here_i_want_ya")}this.spine.play(c.EATING_UP,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>=i.getEatingDelay()){i.getState();let h=new C(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.idiomElapsed=0,this.idiomTime=0}}class C extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!1),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 3:case 7:default:this.idiomSound=this.scene.sound.add("decent");break;case 2:case 4:case 5:case 6:case 8:case 9:case 10:this.idiomSound=this.scene.sound.add("silent")}this.rewardSound=this.scene.sound.add("reward",{volume:.5}),this.rewardSound.play(),this.spine.play(c.MUNCHING_UP,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>i.getMunchingDelay()){i.getState();let h=new f(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.idiomElapsed=0,this.idiomTime=0}}class N extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!1),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 3:case 7:this.idiomSound=this.scene.sound.add("come_here_i_want_ya");break;default:this.idiomSound=this.scene.sound.add("silent")}this.spine.play(c.EATING_DOWN,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>=i.getEatingDelay()){i.getState();let h=new X(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.idiomElapsed=0,this.idiomTime=0}}class X extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.UNDER_ATTACK?new M(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):void 0}enter(e,t,i){switch(i.setMove(!1),this.animationTime=e,this.idiomTime=e,Phaser.Math.Between(0,20)){case 1:case 3:case 5:case 7:case 9:this.idiomSound=this.scene.sound.add("unreal");break;default:this.idiomSound=this.scene.sound.add("silent")}this.rewardSound=this.scene.sound.add("reward",{volume:.5}),this.rewardSound.play(),this.spine.play(c.MUNCHING_DOWN,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>i.getMunchingDelay()){i.getState();let h=new f(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.idiomElapsed=0,this.idiomTime=0}}class M extends v{constructor(e,t){super(e,t)}handleInput(e){return e===c.WALK_LEFT?new E(this.scene,this.spine):e===c.WALK_RIGHT?new b(this.scene,this.spine):e===c.WALK_UP?new A(this.scene,this.spine):e===c.WALK_DOWN?new I(this.scene,this.spine):e===c.EXPIRED?new Y(this.scene,this.spine):void 0}enter(e,t,i){i.setMove(!1),this.animationTime=e,this.idiomTime=e,this.idiomSound=this.scene.sound.add("head_like_a_chewed_toffee"),this.spine.play(c.UNDER_ATTACK,!0)}update(e,t,i){this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.animationTime=0,this.idiomTime=0}}class Y extends v{constructor(e,t){super(e,t)}handleInput(e){}enter(e,t,i){i.setMove(!1),this.animationTime=e,this.idiomTime=e,this.idiomSound=this.scene.sound.add("took_a_hopper"),this.punishmentSound=this.scene.sound.add("punish_one",{volume:.5}),this.punishmentSound.play(),this.spine.play(c.EXPIRED,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>=i.getExpiredDelay()){i.getState();let h=new O(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.animationTime=0,this.idiomTime=0}}class O extends v{constructor(e,t){super(e,t)}handleInput(e){}enter(e,t,i){i.setMove(!1),this.animationTime=e,this.idiomTime=e,this.idiomSound=this.scene.sound.add("dose"),this.spine.play(c.REVIVE,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,console.log("respawn"),i.respawn(),this.animationElapsed>=i.getReviveDelay()){i.getState();let h=new K(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.animationTime=0,this.idiomTime=0}}class K extends v{constructor(e,t){super(e,t)}handleInput(e){}enter(e,t,i){i.setMove(!1),this.animationTime=e,this.idiomTime=e,this.idiomSound=this.scene.sound.add("well_boi_whats_the_craic"),this.punishmentSound=this.scene.sound.add("revived",{volume:.5}),this.punishmentSound.play(),this.spine.play(c.REVIVED,!0)}update(e,t,i){var s,a;if(this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>=i.getRevivedDelay()){i.getState();let h=new f(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){i.setMove(!0),this.animationTime=0,this.idiomTime=0}}class V extends v{constructor(e,t){super(e,t)}handleInput(e){console.log("Process Input ReachedGoal State")}enter(e,t,i){console.log("Entering the ReachedGoal State"),i.setMove(!1),this.animationTime=e,this.idiomTime=e,this.idiomSound=this.scene.sound.add("reached_goal"),this.spine.play(c.REACHED_GOAL,!0)}update(e,t,i){var s,a;if(console.log("Updating the ReachedGoal State"),this.animationElapsed=e-this.animationTime,this.idiomElapsed=e-this.idiomTime,this.animationElapsed>=i.getGoalDelay()){i.getState();let h=new f(this.scene,this.spine);null===(s=i.getState().getState())||void 0===s||s.exit(e,t,i),i.getState().setState(h),null===(a=i.getState().getState())||void 0===a||a.enter(e,t,i)}this.idiomElapsed>=i.getIdiomDelay()&&!this.idiomPlayed&&(this.idiomSound.play(),this.idiomPlayed=!0)}exit(e,t,i){console.log("Exiting the ReachedGoal State"),i.setMove(!0),this.animationTime=0,this.idiomTime=0,i.getCurrentLevel()===h.LEVEL_01?i.setCurrentLevel(h.LEVEL_02):i.getCurrentLevel()===h.LEVEL_02?i.setCurrentLevel(h.LEVEL_03):i.getCurrentLevel()===h.LEVEL_03?i.setCurrentLevel(h.LEVEL_04):i.getCurrentLevel()===h.LEVEL_04?i.setCurrentLevel(h.CREDITS):i.setCurrentLevel(h.LEVEL_01)}}class U{constructor(e,t,i,s){this.state=new f(e,t)}handleInput(e,t,i,s){var a,h,l;let n=null===(a=this.state)||void 0===a?void 0:a.handleInput(e);return void 0!==n&&(null===(h=this.state)||void 0===h||h.exit(t,i,s),this.state=n,null===(l=this.state)||void 0===l||l.enter(t,i,s)),n}update(e,t,i){var s;null===(s=this.state)||void 0===s||s.update(e,t,i)}getState(){return this.state}setState(e){this.state=e}}class W{constructor(e){this.move=!0,this.reSpawnPosition=e,this.position=e,this.velocityX=new Phaser.Math.Vector2(0,0),this.velocityY=new Phaser.Math.Vector2(0,0),this.eatingDelay=1e3,this.munchingDelay=1e3,this.underAttackDelay=1e3,this.expiredDelay=1e3,this.reviveDelay=1e3,this.revivedDelay=1e3,this.goalDelay=2e3,this.idiomDelay=200,this.scale=.25}getCurrentLevel(){return this.current_level===h.LEVEL_01?(this.next_level=h.LEVEL_02,this.current_artifact=l.ArtiFactOneScene,this.next_artifact=l.ArtiFactTwoScene):this.current_level===h.LEVEL_02?(this.next_level=h.LEVEL_03,this.current_artifact=l.ArtiFactTwoScene,this.next_artifact=l.ArtiFactThreeScene):this.current_level===h.LEVEL_03?(this.next_level=h.LEVEL_04,this.current_artifact=l.ArtiFactThreeScene,this.next_artifact=l.ArtiFactFourScene):this.current_level===h.LEVEL_04?(this.next_level=h.CREDITS,this.current_artifact=l.ArtiFactOneScene,this.next_artifact=l.ArtiFactOneScene):this.current_level===h.CREDITS?(this.next_level=h.LEVEL_01,this.current_artifact=l.ArtiFactOneScene,this.next_artifact=l.ArtiFactOneScene):(this.next_level=h.LEVEL_02,this.current_artifact=l.ArtiFactOneScene,this.next_artifact=l.ArtiFactTwoScene),this.current_level}getNextLevel(){return this.next_level}getCurrentArtifact(){return this.current_artifact}getNextArtifact(){return this.next_artifact}setCurrentLevel(e){return this.current_level=e,this.current_level}setMove(e){this.move=e}getMove(){return this.move}respawn(){this.position=this.reSpawnPosition}getEatingDelay(){return this.eatingDelay}getMunchingDelay(){return this.munchingDelay}getUnderAttackDelay(){return this.underAttackDelay}getExpiredDelay(){return this.expiredDelay}getReviveDelay(){return this.reviveDelay}getRevivedDelay(){return this.revivedDelay}getGoalDelay(){return this.goalDelay}getIdiomDelay(){return this.idiomDelay}getX(){return this.position.x}getY(){return this.position.y}setX(e){this.position.x=e}setY(e){this.position.y=e}setVelocityX(e){this.velocityX=e}setVelocityY(e){this.velocityY=e}getVelocityX(){return this.velocityX}getVelocityY(){return this.velocityY}getState(){return this.state}setState(e){this.state=e}getScale(){return this.scale}moveLeft(){this.move&&this.position.subtract(this.velocityX)}moveRight(){this.move&&this.position.add(this.velocityX)}moveUp(){this.move&&this.position.subtract(this.velocityY)}moveDown(){this.move&&this.position.add(this.velocityY)}}const j="truffles",z="idle",G="cannonball",F="windmill",B="dpad",H=["orange","lemon","grape"],J="diver",q="soundbtn",Q="hudtimer";class Z extends Phaser.Scene{constructor(){super({key:"LEVEL_01"}),this.divers=[],this.cannonball=[],this.fruit=[],this.trufflesAnimationNames=[],this.trufflesAnimationIndex=0,this.diverAnimationNames=[],this.diverAnimationIndex=0,this.diverMove=[],this.fruitAnimationNames=[],this.fruitMarked=[],this.orangeAnimationIndex=0,this.grapeAnimationIndex=0,this.lemonAnimationIndex=0,this.dpadAnimationIndex=0,this.dpadAnimationNames=[],this.tileSize=32,this.cannonballAnimationNames=[],this.cannonballAnimationIndex=0,this.cannonballPosX=[269,525,781],this.cannonballPosY=[60,60,60],this.cannonballSpeed=2,this.cannonballMoving=[!0,!0,!0],this.collectablePoints=0,this.levelScore=0,this.newRecordTime=0,this.screenX=0,this.screenY=0}preload(e,t){this.load.image("tileset","assets/level/truffles_level_1_tileset.png"),this.load.tilemapTiledJSON("level","assets/level/truffles_level_1.json"),this.load.setPath("assets/spine/"),this.load.spine(j,"truffles/truffles_all.json","truffles/truffles_all.atlas"),this.load.spine(J,"diver/diver.json","diver/diver.atlas"),this.load.spine(H[0],"fruits/orange/orange.json","fruits/orange/orange.atlas"),this.load.spine(H[1],"fruits/grape/grape.json","fruits/grape/grape.atlas"),this.load.spine(H[2],"fruits/lemon/lemon.json","fruits/lemon/lemon.atlas"),this.load.spine(G,"cannonball/cannonball.json","cannonball/cannonball.atlas"),this.load.spine(F,"windmill/windmill.json","windmill/windmill.atlas"),this.load.spine(B,"dpad/DPad_02.json","dpad/DPad_02.atlas"),this.load.spine(q,"sound/sound.json","sound/sound.atlas"),this.load.spine(Q,"timer/timer.json","timer/timer.atlas")}create(e,t){var i;let{width:a,height:h}=this.sys.game.canvas;this.screenX=a,this.screenY=h,this.player=new W(new Phaser.Math.Vector2(100,360)),this.player.setVelocityX(new Phaser.Math.Vector2(2,0)),this.player.setVelocityY(new Phaser.Math.Vector2(0,2)),this.gameState=s.PLAY,this.fetchRecordedScore(),this.fetchRecordedTime(),this.loadCurrentLevel(),this.currentScoreText=new g(this),this.currentScoreText.setShadow(3,3),this.currentScoreText.setStroke("#fff",16),this.currentScoreText.setShadow(2,2,"#333333",2,!0,!0),this.elapsedTimeText=new g(this),this.elapsedTimeText.setShadow(3,3),this.elapsedTimeText.setStroke("#fff",16),this.elapsedTimeText.setShadow(2,2,"#333333",2,!0,!0),this.recordTimeText=new g(this),this.recordTimeText.setShadow(3,3),this.recordTimeText.setStroke("#fff",16),this.recordTimeText.setShadow(2,2,"#333333",2,!0,!0),this.hudtimer=this.createSpineObject(z,Q,.67*this.screenX,.001*this.screenY,1,1).setDepth(5).setScale(.75,.75);let l=this.hudtimer.getAnimationList();this.hudtimer.play(l[1],!0),this.time.addEvent({delay:500,loop:!0,callback:this.fetchRecordedScore,callbackScope:this}),this.setupMap();var n=this.map.width,c=this.map.height;this.backingMusic=this.sound.add("level_backing_track",{loop:!0}),this.backingMusic.play(),this.churchBells=this.sound.add("church_bells",{volume:.5}),this.time.addEvent({delay:6e3,loop:!0,callback:this.playChurchBells,callbackScope:this}),this.truffles=this.createSpineObject(z,j,this.player.getX(),this.player.getY(),this.player.getScale(),this.player.getScale()),this.truffles.setDepth(2),this.initializeAnimationsState(this.truffles,this.trufflesAnimationNames);for(let e=0;e<c;e++)for(let t=0;t<n;t++){var p=this.diverLayer.getTileAt(t,e);null!=p&&p.index===r.START&&(this.divers.push(this.createSpineObject(d.WALK_DOWN,J,t*this.tileSize,e*this.tileSize+(this.tileSize-1),r.SCALE,r.SCALE)),this.diverMove.push(r.SPEED))}for(let e=0;e<this.divers.length;e++)this.initializeAnimationsState(this.divers[e],this.diverAnimationNames),this.divers[e].setDepth(2);this.cannonball.push(this.createSpineObject(z,G,this.cannonballPosX[0],this.cannonballPosY[0],1.2,1.2)),this.cannonball.push(this.createSpineObject(z,G,this.cannonballPosX[1],this.cannonballPosY[1],1.2,1.2)),this.cannonball.push(this.createSpineObject(z,G,this.cannonballPosX[2],this.cannonballPosY[2],1.2,1.2));for(let e=0;e<this.cannonball.length;e++)this.cannonball[e].setDepth(2),this.initializeAnimationsState(this.cannonball[e],this.cannonballAnimationNames),this.cannonball[e].setDepth(0);this.windmill=this.createSpineObject(z,F,50,0,1,1),this.windmill.setDepth(1),this.cursors=this.input.keyboard.createCursorKeys(),this.keys=this.input.keyboard.addKeys("W,A,S,D"),this.input.addPointer(2),this.dpad=this.createSpineObject(z,B,1180,630,1,1).setScale(.9).setDepth(5);let m=this.dpad.getBoneList(),u=this.dpad.getAnimationList();for(var y=0;y<m.length;y++){let e=this.dpad.findBone(m[y]),t=this.add.circle(e.worldX,720-e.worldY,15,0,0);t.bone=e.data.name,t.setDepth(5),t.setInteractive(),t.on("pointerdown",(function(e){let t=this.bone;switch(t){case"Up":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad up");break;case"Down":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad down");break;case"Left":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad left");break;case"Right":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad right");break;case"LeftDown":case"LeftUp":case"RightDown":case"RightUp":case"Static":this.dpadAnimationIndex=u.indexOf(t);break;default:this.dpadAnimationIndex=u.indexOf("Static")}})),t.on("pointerup",(function(){this.dpadAnimationIndex=u.indexOf("Static")}))}for(let e=0;e<c;e++)for(let t=0;t<n;t++)p=this.candyLayer.getTileAt(t,e),null!=p&&(p.index===o.ORANGE_TILE?(this.fruit.push(this.createSpineObject(z,H[0],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)):p.index===o.LEMON_TILE?(this.fruit.push(this.createSpineObject(z,H[1],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)):p.index===o.GRAPE_TILE&&(this.fruit.push(this.createSpineObject(z,H[2],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)));for(let e=0;e<this.fruit.length;e++)this.initializeAnimationsState(this.fruit[e],this.fruitAnimationNames);this.soundbtn=this.createSpineObject(z,q,.001*this.screenX,.001*this.screenY,1,1).setScale(.8,.8).setDepth(5).setInteractive();let L=this.soundbtn.getAnimationList(),T=(window.localStorage.getItem("soundState"),!0);"false"===window.localStorage.getItem("soundState")&&(this.game.sound.mute=!0,this.soundbtn.play(L[1],!0)),this.soundbtn.on("pointerdown",(()=>1==T?(T=!1,this.soundbtn.play(L[1],!0),window.localStorage.setItem("soundState",T.toString()),void(this.game.sound.mute=!0)):0==T?(T=!0,this.game.sound.mute=!1,this.soundbtn.play(L[0],!0),void window.localStorage.setItem("soundState",T.toString())):void 0)),this.playerState=new U(this,this.truffles,0,0),null===(i=this.playerState.getState())||void 0===i||i.enter(0,0,this.player),this.player.setState(this.playerState)}update(e,t){var i;if(this.setCurrentLevel(),this.gameState===s.PLAY?this.elapsedLevelTime=e:this.gameState===s.LEVEL_COMPLETE&&(Math.round(.001*this.elapsedLevelTime)<=this.bestRecordedTime?(this.setRecord(Math.round(.001*this.elapsedLevelTime)),this.fetchRecordedTime()):this.newRecordTime=this.bestRecordedTime,this.time.addEvent({delay:6e3,loop:!0,callback:this.levelComplete,callbackScope:this})),this.cannonballMove(),this.trufflesAnimationNames.length,Phaser.Input.Keyboard.JustDown(this.cursors.right)?this.player.getState().handleInput(c.WALK_RIGHT,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.left)?this.player.getState().handleInput(c.WALK_LEFT,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.up)?this.player.getState().handleInput(c.WALK_UP,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.down)?this.player.getState().handleInput(c.WALK_DOWN,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.keys.D)?(console.log("D"),this.player.getState().handleInput(c.WALK_RIGHT,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.A)?(console.log("A"),this.player.getState().handleInput(c.WALK_LEFT,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.W)?(console.log("W"),this.player.getState().handleInput(c.WALK_UP,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.S)&&(console.log("S"),this.player.getState().handleInput(c.WALK_DOWN,e,t,this.player)),this.player.getMove()){if(this.cursors.right.isDown){let i=this.map.worldToTileX(this.player.getX()-this.tileSize/2),s=this.map.worldToTileY(this.player.getY());this.tile=this.collisionLayer.getTileAt(i+1,s),null==this.tile&&(this.player.moveRight(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.left.isDown){let i=this.map.worldToTileX(this.player.getX()+this.tileSize/2),s=this.map.worldToTileY(this.player.getY());this.tile=this.collisionLayer.getTileAt(i-1,s),null==this.tile&&(this.player.moveLeft(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.up.isDown){let i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()+this.tileSize/4);this.tile=this.collisionLayer.getTileAt(i,s-1),null==this.tile&&(this.player.moveUp(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.down.isDown){let i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()+this.player.getVelocityY().y);this.tile=this.collisionLayer.getTileAt(i,s),null==this.tile&&(this.player.moveDown(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.down.isDown||this.cursors.up.isDown||this.cursors.left.isDown||this.cursors.right.isDown)for(let i=0;i<this.fruit.length;i++)!this.fruitMarked[i]&&this.trufflesAABB(this.fruit[i])&&(console.log("Fruit Collision "+i),this.changeAnimation(this.fruit[i],this.fruitAnimationNames,1),this.time.addEvent({delay:480,callback:this.fruitAnimate,callbackScope:this,args:[i,e,t]}),this.fruitMarked[i]=!0,this.addPoints(250),this.player.getState().handleInput(c.EATING,e,t,this.player));else this.player.getState().handleInput(c.IDLE,e,t,this.player)}for(let i=0;i<this.divers.length;i++)this.trufflesEnemyCollision(this.divers[i])&&(this.player.getState().handleInput(c.EXPIRED,e,t,this.player),this.addPoints(-150));for(let e=0;e<this.divers.length;e++){this.divers[e].y+=this.diverMove[e];const t=this.map.worldToTileX(this.divers[e].x),i=this.map.worldToTileY(this.divers[e].y);this.tile=this.diverLayer.getTileAt(t,i),this.tile.index==r.START?(this.diverMove[e]=r.SPEED,this.divers[e].play(d.WALK_DOWN,!0)):this.tile.index==r.END&&(this.diverMove[e]=-r.SPEED,this.divers[e].play(d.WALK_UP,!0))}for(let i=0;i<this.cannonball.length;i++)this.trufflesAABB(this.cannonball[i])&&(this.player.getState().handleInput(c.EXPIRED,e,t,this.player),this.addPoints(-150));null===(i=this.player.getState().getState())||void 0===i||i.update(e,t,this.player),this.currentScoreText.setPosition(.9*this.screenX,.04*this.screenY),this.currentScoreText.update(),this.currentScoreText.setText(" "+this.levelScore+" "),this.currentScoreText.setDepth(10),this.elapsedTimeText.setPosition(.75*this.screenX,.04*this.screenY),this.elapsedTimeText.update(),this.elapsedTimeText.setText(" "+Math.round(.001*this.elapsedLevelTime)+" "),this.elapsedTimeText.setDepth(10),this.recordTimeText.setPosition(.55*this.screenX,.04*this.screenY),this.recordTimeText.update(),this.recordTimeText.setText(" "+this.bestRecordedTime+" "),this.recordTimeText.setDepth(10)}setupMap(){this.map=this.make.tilemap({key:"level",tileWidth:this.tileSize,tileHeight:this.tileSize}),this.tileset=this.map.addTilesetImage("truffles_level_1_tileset","tileset"),this.waterLayer=this.map.createLayer("map/water/water_depth_00",this.tileset,0,0),this.waterLayer.setDepth(0),this.groundLayer=this.map.createLayer("map/ground/ground_depth_00",this.tileset,0,0),this.groundLayer.setDepth(0),this.ground2Layer=this.map.createLayer("map/shadow/shadow_depth_01",this.tileset,0,0),this.ground2Layer.setDepth(1),this.house2Layer=this.map.createLayer("map/buildings/foreground/house_depth_01/house_layer_2",this.tileset,0,0),this.house2Layer.setDepth(1),this.house1Layer=this.map.createLayer("map/buildings/foreground/house_depth_01/house_layer_1",this.tileset,0,0),this.house1Layer.setDepth(1),this.wall1Layer=this.map.createLayer("map/castle/walls/walls_depth_01",this.tileset,0,0),this.wall1Layer.setDepth(1),this.wall2Layer=this.map.createLayer("map/castle/walls/walls_depth_03",this.tileset,0,0),this.wall2Layer.setDepth(3),this.churchLayer=this.map.createLayer("map/buildings/foreground/church_depth_01/church_01",this.tileset,0,0),this.churchLayer.setDepth(1),this.castleLayer=this.map.createLayer("map/castle/castle/castle_depth_01",this.tileset,0,0),this.castleLayer.setDepth(1),this.miscLayer=this.map.createLayer("map/environment_objects/miscellaneous_depth_01",this.tileset,0,0),this.miscLayer.setDepth(1),this.wallTop1Layer=this.map.createLayer("map/castle/walls/wall_top_depth_01",this.tileset,0,0),this.wallTop1Layer.setDepth(1),this.wallTop2Layer=this.map.createLayer("map/castle/walls/wall_top_depth_04",this.tileset,0,0),this.wallTop2Layer.setDepth(4),this.house2RoofLayer=this.map.createLayer("map/buildings/background/house_roof_depth_03/house_roof_layer_2",this.tileset,0,0),this.house2RoofLayer.setDepth(3),this.houseRoofLayer=this.map.createLayer("map/buildings/background/house_roof_depth_03/house_roof_layer_1",this.tileset,0,0),this.houseRoofLayer.setDepth(3),this.towerTop1Layer=this.map.createLayer("map/castle/tower/tower_top_depth_01",this.tileset,0,0),this.towerTop1Layer.setDepth(1),this.towerTop2Layer=this.map.createLayer("map/castle/tower/tower_top_depth_04",this.tileset,0,0),this.towerTop2Layer.setDepth(4),this.churchRoofLayer=this.map.createLayer("map/buildings/background/church_depth_03/church_roof_03",this.tileset,0,0),this.churchRoofLayer.setDepth(1),this.castleRoofLayer=this.map.createLayer("map/castle/castle/castle_roof_depth_02",this.tileset,0,0),this.castleRoofLayer.setDepth(2),this.miscTop1Layer=this.map.createLayer("map/environment_objects/tree_01",this.tileset,0,0),this.miscTop1Layer.setDepth(1),this.miscTop2Layer=this.map.createLayer("map/environment_objects/tree_top_04",this.tileset,0,0),this.miscTop2Layer.setDepth(4),this.collisionLayer=this.map.createLayer("map/environment_collision/collide_depth_02",this.tileset,0,0),this.collisionLayer.setDepth(2),this.collisionLayer.setVisible(!1);let e,t=window.localStorage.getItem(a.CURRENT);e=null!==t?t:h.LEVEL_01,e===h.LEVEL_01?(this.candyLayer=this.map.createLayer("map/collectables/candies_level1_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level1",this.tileset,0,0)):e===h.LEVEL_02?(this.candyLayer=this.map.createLayer("map/collectables/candies_level2_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level2",this.tileset,0,0)):e===h.LEVEL_03?(this.candyLayer=this.map.createLayer("map/collectables/candies_level3_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level3",this.tileset,0,0)):e===h.LEVEL_04?(this.candyLayer=this.map.createLayer("map/collectables/candies_level4_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level4",this.tileset,0,0)):(this.candyLayer=this.map.createLayer("map/collectables/candies_level1_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level1",this.tileset,0,0)),this.candyLayer.setDepth(2),this.candyLayer.setVisible(!1),this.diverLayer.setDepth(2),this.diverLayer.setVisible(!0),this.goalLayer=this.map.createLayer("map/goal/goal_depth_02",this.tileset,0,0),this.goalLayer.setDepth(2),this.goalLayer.setVisible(!0)}createSpineObject(e,t,i,s,a,h){let l=this.add.spine(i,s,t,e,!0);return l.scaleX=a,l.scaleY=h,l}initializeAnimationsState(e,t){const i=e.getCurrentAnimation().name;e.getAnimationList().forEach(((e,s)=>{t.push(e),e===i&&(this.trufflesAnimationIndex=s)}))}changeAnimation(e,t,i){const s=t[i];e.play(s,!0)}trufflesAABB(e){var t=!1;return this.player.getX()-this.tileSize/2<e.x+e.scaleX*e.width&&this.player.getX()+this.tileSize/2>e.x&&this.player.getY()-this.tileSize<e.y+e.scaleY*e.height&&this.player.getY()>e.y&&(t=!0),t}trufflesEnemyCollision(e){var t=!1;return this.map.worldToTileX(this.player.getX())!=this.map.worldToTileX(e.x)&&this.map.worldToTileX(this.player.getX())!=this.map.worldToTileX(e.x)-1||this.map.worldToTileY(this.player.getY())!=this.map.worldToTileY(e.y)||(t=!0),t}playChurchBells(e,t,i){let s=Phaser.Math.Between(0,24);12!==s&&6!==s||this.churchBells.play()}fruitAnimate(e,t,i){this.changeAnimation(this.fruit[e],this.fruitAnimationNames,2),this.time.addEvent({delay:1e3,callback:this.fruitDelete,callbackScope:this,args:[e,t,i]})}fruitDelete(e,t,i){const s=this.map.worldToTileX(this.fruit[e].x),a=this.map.worldToTileY(this.fruit[e].y);this.tile=this.candyLayer.getTileAt(s,a),this.map.removeTile(this.tile),this.fruit[e].removeFromDisplayList()}cannonballReset(e){this.cannonball[e].setPosition(this.cannonballPosX[e],this.cannonballPosY[e]=40),this.changeAnimation(this.cannonball[e],this.cannonballAnimationNames,1),this.cannonballMoving[e]=!0}cannonballMove(){for(let e=0;e<this.cannonball.length;e++)this.cannonballMoving[e]&&(this.cannonballPosY[e]+=this.cannonballSpeed,this.cannonball[e].setPosition(this.cannonballPosX[e],this.cannonballPosY[e])),this.cannonballPosY[e]>=655&&(this.time.addEvent({delay:600,callback:this.cannonballReset,callbackScope:this,args:[e]}),this.cannonballMoving[e]&&this.changeAnimation(this.cannonball[e],this.cannonballAnimationNames,2),this.cannonballMoving[e]=!1)}setRecord(e){this.newRecordTime=e}addPoints(e){e>0&&(this.collectablePoints+=e)}fetchRecordedTime(){let e=window.localStorage.getItem("time_"+this.loadCurrentLevel());null!==e?(this.bestRecordedTime=parseInt(e)||0,0===this.bestRecordedTime&&(this.bestRecordedTime=1e3)):this.bestRecordedTime=0,window.localStorage.setItem("time_"+this.loadCurrentLevel(),this.newRecordTime.toString())}fetchRecordedScore(){let e=window.localStorage.getItem("score_"+this.loadCurrentLevel());this.levelScore=null!==e&&parseInt(e)||0,this.levelScore+=this.collectablePoints,this.collectablePoints=0,window.localStorage.setItem("score_"+this.loadCurrentLevel(),this.levelScore.toString())}loadCurrentLevel(){let e=window.localStorage.getItem(a.CURRENT);return null!==e?this.player.setCurrentLevel(e):this.player.setCurrentLevel(h.LEVEL_01),window.localStorage.setItem(a.CURRENT,this.player.getCurrentLevel()),window.localStorage.setItem(a.NEXT,this.player.getNextLevel()),window.localStorage.setItem(a.CURRENT_ARTIFACT,this.player.getCurrentArtifact()),window.localStorage.setItem(a.NEXT_ARTIFACT,this.player.getNextArtifact()),this.player.getCurrentLevel()}setCurrentLevel(){let e,t=window.localStorage.getItem(a.CURRENT);return e=null!==t?t:h.LEVEL_01,this.player.getCurrentLevel()!==e&&(window.localStorage.setItem(a.CURRENT,this.player.getCurrentLevel()),window.localStorage.setItem(a.NEXT,this.player.getNextLevel()),window.localStorage.setItem(a.CURRENT_ARTIFACT,this.player.getCurrentArtifact()),window.localStorage.setItem(a.NEXT_ARTIFACT,this.player.getNextArtifact())),this.player.getCurrentLevel()}gsmUpdate(e,t){this.gameState=s.LEVEL_COMPLETE}levelComplete(){window.localStorage.setItem(a.CURRENT,h.LEVEL_02),this.backingMusic.stop(),this.scene.start("ArtiFactOneScene")}}const $="truffles",ee="idle",te="cannonball",ie="windmill",se="dpad",ae=["orange","lemon","grape"],he="diver",le="soundbtn",ne="hudtimer";class oe extends Phaser.Scene{constructor(){super({key:"LEVEL_02"}),this.divers=[],this.cannonball=[],this.fruit=[],this.trufflesAnimationNames=[],this.trufflesAnimationIndex=0,this.diverAnimationNames=[],this.diverAnimationIndex=0,this.diverMove=[],this.fruitAnimationNames=[],this.fruitMarked=[],this.orangeAnimationIndex=0,this.grapeAnimationIndex=0,this.lemonAnimationIndex=0,this.dpadAnimationIndex=0,this.dpadAnimationNames=[],this.tileSize=32,this.cannonballAnimationNames=[],this.cannonballAnimationIndex=0,this.cannonballPosX=[269,525,781],this.cannonballPosY=[60,60,60],this.cannonballSpeed=2,this.cannonballMoving=[!0,!0,!0],this.collectablePoints=0,this.levelScore=0,this.newRecordTime=0,this.screenX=0,this.screenY=0}preload(e,t){this.load.image("tileset","assets/level/truffles_level_1_tileset.png"),this.load.tilemapTiledJSON("level","assets/level/truffles_level_1.json"),this.load.setPath("assets/spine/"),this.load.spine($,"truffles/truffles_all.json","truffles/truffles_all.atlas"),this.load.spine(he,"diver/diver.json","diver/diver.atlas"),this.load.spine(ae[0],"fruits/orange/orange.json","fruits/orange/orange.atlas"),this.load.spine(ae[1],"fruits/grape/grape.json","fruits/grape/grape.atlas"),this.load.spine(ae[2],"fruits/lemon/lemon.json","fruits/lemon/lemon.atlas"),this.load.spine(te,"cannonball/cannonball.json","cannonball/cannonball.atlas"),this.load.spine(ie,"windmill/windmill.json","windmill/windmill.atlas"),this.load.spine(se,"dpad/DPad_02.json","dpad/DPad_02.atlas"),this.load.spine(le,"sound/sound.json","sound/sound.atlas"),this.load.spine(ne,"timer/timer.json","timer/timer.atlas")}create(e,t){var i;let{width:a,height:h}=this.sys.game.canvas;this.screenX=a,this.screenY=h,this.player=new W(new Phaser.Math.Vector2(100,360)),this.player.setVelocityX(new Phaser.Math.Vector2(2,0)),this.player.setVelocityY(new Phaser.Math.Vector2(0,2)),this.gameState=s.PLAY,this.fetchRecordedScore(),this.fetchRecordedTime(),this.loadCurrentLevel(),this.currentScoreText=new g(this),this.currentScoreText.setShadow(3,3),this.currentScoreText.setStroke("#fff",16),this.currentScoreText.setShadow(2,2,"#333333",2,!0,!0),this.elapsedTimeText=new g(this),this.elapsedTimeText.setShadow(3,3),this.elapsedTimeText.setStroke("#fff",16),this.elapsedTimeText.setShadow(2,2,"#333333",2,!0,!0),this.recordTimeText=new g(this),this.recordTimeText.setShadow(3,3),this.recordTimeText.setStroke("#fff",16),this.recordTimeText.setShadow(2,2,"#333333",2,!0,!0),this.hudtimer=this.createSpineObject(ee,ne,.67*this.screenX,.001*this.screenY,1,1).setDepth(5).setScale(.75,.75);let l=this.hudtimer.getAnimationList();this.hudtimer.play(l[1],!0),this.time.addEvent({delay:500,loop:!0,callback:this.fetchRecordedScore,callbackScope:this}),this.setupMap();var n=this.map.width,c=this.map.height;this.backingMusic=this.sound.add("level_backing_track",{loop:!0}),this.backingMusic.play(),this.churchBells=this.sound.add("church_bells",{volume:.5}),this.time.addEvent({delay:6e3,loop:!0,callback:this.playChurchBells,callbackScope:this}),this.truffles=this.createSpineObject(ee,$,this.player.getX(),this.player.getY(),this.player.getScale(),this.player.getScale()),this.truffles.setDepth(2),this.initializeAnimationsState(this.truffles,this.trufflesAnimationNames);for(let e=0;e<c;e++)for(let t=0;t<n;t++){var p=this.diverLayer.getTileAt(t,e);null!=p&&p.index===r.START&&(this.divers.push(this.createSpineObject(d.WALK_DOWN,he,t*this.tileSize,e*this.tileSize+(this.tileSize-1),r.SCALE,r.SCALE)),this.diverMove.push(r.SPEED))}for(let e=0;e<this.divers.length;e++)this.initializeAnimationsState(this.divers[e],this.diverAnimationNames),this.divers[e].setDepth(2);this.cannonball.push(this.createSpineObject(ee,te,this.cannonballPosX[0],this.cannonballPosY[0],1.2,1.2)),this.cannonball.push(this.createSpineObject(ee,te,this.cannonballPosX[1],this.cannonballPosY[1],1.2,1.2)),this.cannonball.push(this.createSpineObject(ee,te,this.cannonballPosX[2],this.cannonballPosY[2],1.2,1.2));for(let e=0;e<this.cannonball.length;e++)this.cannonball[e].setDepth(2),this.initializeAnimationsState(this.cannonball[e],this.cannonballAnimationNames),this.cannonball[e].setDepth(0);this.windmill=this.createSpineObject(ee,ie,50,0,1,1),this.windmill.setDepth(1),this.cursors=this.input.keyboard.createCursorKeys(),this.keys=this.input.keyboard.addKeys("W,A,S,D"),this.input.addPointer(2),this.dpad=this.createSpineObject(ee,se,1180,630,1,1).setScale(.9).setDepth(5);let m=this.dpad.getBoneList(),u=this.dpad.getAnimationList();for(var y=0;y<m.length;y++){let e=this.dpad.findBone(m[y]),t=this.add.circle(e.worldX,720-e.worldY,15,0,0);t.bone=e.data.name,t.setDepth(5),t.setInteractive(),t.on("pointerdown",(function(e){let t=this.bone;switch(t){case"Up":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad up");break;case"Down":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad down");break;case"Left":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad left");break;case"Right":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad right");break;case"LeftDown":case"LeftUp":case"RightDown":case"RightUp":case"Static":this.dpadAnimationIndex=u.indexOf(t);break;default:this.dpadAnimationIndex=u.indexOf("Static")}})),t.on("pointerup",(function(){this.dpadAnimationIndex=u.indexOf("Static")}))}for(let e=0;e<c;e++)for(let t=0;t<n;t++)p=this.candyLayer.getTileAt(t,e),null!=p&&(p.index===o.ORANGE_TILE?(this.fruit.push(this.createSpineObject(ee,ae[0],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)):p.index===o.LEMON_TILE?(this.fruit.push(this.createSpineObject(ee,ae[1],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)):p.index===o.GRAPE_TILE&&(this.fruit.push(this.createSpineObject(ee,ae[2],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)));for(let e=0;e<this.fruit.length;e++)this.initializeAnimationsState(this.fruit[e],this.fruitAnimationNames);this.soundbtn=this.createSpineObject(ee,le,.001*this.screenX,.001*this.screenY,1,1).setScale(.8,.8).setDepth(5).setInteractive();let L=this.soundbtn.getAnimationList(),T=(window.localStorage.getItem("soundState"),!0);"false"===window.localStorage.getItem("soundState")&&(this.game.sound.mute=!0,this.soundbtn.play(L[1],!0)),this.soundbtn.on("pointerdown",(()=>1==T?(T=!1,this.soundbtn.play(L[1],!0),window.localStorage.setItem("soundState",T.toString()),void(this.game.sound.mute=!0)):0==T?(T=!0,this.game.sound.mute=!1,this.soundbtn.play(L[0],!0),void window.localStorage.setItem("soundState",T.toString())):void 0)),this.playerState=new U(this,this.truffles,0,0),null===(i=this.playerState.getState())||void 0===i||i.enter(0,0,this.player),this.player.setState(this.playerState)}update(e,t){var i;if(this.setCurrentLevel(),this.gameState===s.PLAY?this.elapsedLevelTime=e:this.gameState===s.LEVEL_COMPLETE&&(Math.round(.001*this.elapsedLevelTime)<=this.bestRecordedTime?(this.setRecord(Math.round(.001*this.elapsedLevelTime)),this.fetchRecordedTime()):this.newRecordTime=this.bestRecordedTime,this.time.addEvent({delay:6e3,loop:!0,callback:this.levelComplete,callbackScope:this})),this.cannonballMove(),this.trufflesAnimationNames.length,Phaser.Input.Keyboard.JustDown(this.cursors.right)?this.player.getState().handleInput(c.WALK_RIGHT,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.left)?this.player.getState().handleInput(c.WALK_LEFT,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.up)?this.player.getState().handleInput(c.WALK_UP,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.down)?this.player.getState().handleInput(c.WALK_DOWN,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.keys.D)?(console.log("D"),this.player.getState().handleInput(c.WALK_RIGHT,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.A)?(console.log("A"),this.player.getState().handleInput(c.WALK_LEFT,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.W)?(console.log("W"),this.player.getState().handleInput(c.WALK_UP,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.S)&&(console.log("S"),this.player.getState().handleInput(c.WALK_DOWN,e,t,this.player)),this.player.getMove()){if(this.cursors.right.isDown){let i=this.map.worldToTileX(this.player.getX()-this.tileSize/2),s=this.map.worldToTileY(this.player.getY());this.tile=this.collisionLayer.getTileAt(i+1,s),null==this.tile&&(this.player.moveRight(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.left.isDown){let i=this.map.worldToTileX(this.player.getX()+this.tileSize/2),s=this.map.worldToTileY(this.player.getY());this.tile=this.collisionLayer.getTileAt(i-1,s),null==this.tile&&(this.player.moveLeft(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.up.isDown){let i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()+this.tileSize/4);this.tile=this.collisionLayer.getTileAt(i,s-1),null==this.tile&&(this.player.moveUp(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.down.isDown){let i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()+this.player.getVelocityY().y);this.tile=this.collisionLayer.getTileAt(i,s),null==this.tile&&(this.player.moveDown(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.down.isDown||this.cursors.up.isDown||this.cursors.left.isDown||this.cursors.right.isDown)for(let i=0;i<this.fruit.length;i++)!this.fruitMarked[i]&&this.trufflesAABB(this.fruit[i])&&(console.log("Fruit Collision "+i),this.changeAnimation(this.fruit[i],this.fruitAnimationNames,1),this.time.addEvent({delay:480,callback:this.fruitAnimate,callbackScope:this,args:[i,e,t]}),this.fruitMarked[i]=!0,this.addPoints(250),this.player.getState().handleInput(c.EATING,e,t,this.player));else this.player.getState().handleInput(c.IDLE,e,t,this.player)}for(let i=0;i<this.divers.length;i++)this.trufflesEnemyCollision(this.divers[i])&&(this.player.getState().handleInput(c.EXPIRED,e,t,this.player),this.addPoints(-150));for(let e=0;e<this.divers.length;e++){this.divers[e].y+=this.diverMove[e];const t=this.map.worldToTileX(this.divers[e].x),i=this.map.worldToTileY(this.divers[e].y);this.tile=this.diverLayer.getTileAt(t,i),this.tile.index==r.START?(this.diverMove[e]=r.SPEED,this.divers[e].play(d.WALK_DOWN,!0)):this.tile.index==r.END&&(this.diverMove[e]=-r.SPEED,this.divers[e].play(d.WALK_UP,!0))}for(let i=0;i<this.cannonball.length;i++)this.trufflesAABB(this.cannonball[i])&&(this.player.getState().handleInput(c.EXPIRED,e,t,this.player),this.addPoints(-150));null===(i=this.player.getState().getState())||void 0===i||i.update(e,t,this.player),this.currentScoreText.setPosition(.9*this.screenX,.04*this.screenY),this.currentScoreText.update(),this.currentScoreText.setText(" "+this.levelScore+" "),this.currentScoreText.setDepth(10),this.elapsedTimeText.setPosition(.75*this.screenX,.04*this.screenY),this.elapsedTimeText.update(),this.elapsedTimeText.setText(" "+Math.round(.001*this.elapsedLevelTime)+" "),this.elapsedTimeText.setDepth(10),this.recordTimeText.setPosition(.55*this.screenX,.04*this.screenY),this.recordTimeText.update(),this.recordTimeText.setText(" "+this.bestRecordedTime+" "),this.recordTimeText.setDepth(10)}setupMap(){this.map=this.make.tilemap({key:"level",tileWidth:this.tileSize,tileHeight:this.tileSize}),this.tileset=this.map.addTilesetImage("truffles_level_1_tileset","tileset"),this.waterLayer=this.map.createLayer("map/water/water_depth_00",this.tileset,0,0),this.waterLayer.setDepth(0),this.groundLayer=this.map.createLayer("map/ground/ground_depth_00",this.tileset,0,0),this.groundLayer.setDepth(0),this.ground2Layer=this.map.createLayer("map/shadow/shadow_depth_01",this.tileset,0,0),this.ground2Layer.setDepth(1),this.house2Layer=this.map.createLayer("map/buildings/foreground/house_depth_01/house_layer_2",this.tileset,0,0),this.house2Layer.setDepth(1),this.house1Layer=this.map.createLayer("map/buildings/foreground/house_depth_01/house_layer_1",this.tileset,0,0),this.house1Layer.setDepth(1),this.wall1Layer=this.map.createLayer("map/castle/walls/walls_depth_01",this.tileset,0,0),this.wall1Layer.setDepth(1),this.wall2Layer=this.map.createLayer("map/castle/walls/walls_depth_03",this.tileset,0,0),this.wall2Layer.setDepth(3),this.churchLayer=this.map.createLayer("map/buildings/foreground/church_depth_01/church_01",this.tileset,0,0),this.churchLayer.setDepth(1),this.castleLayer=this.map.createLayer("map/castle/castle/castle_depth_01",this.tileset,0,0),this.castleLayer.setDepth(1),this.miscLayer=this.map.createLayer("map/environment_objects/miscellaneous_depth_01",this.tileset,0,0),this.miscLayer.setDepth(1),this.wallTop1Layer=this.map.createLayer("map/castle/walls/wall_top_depth_01",this.tileset,0,0),this.wallTop1Layer.setDepth(1),this.wallTop2Layer=this.map.createLayer("map/castle/walls/wall_top_depth_04",this.tileset,0,0),this.wallTop2Layer.setDepth(4),this.house2RoofLayer=this.map.createLayer("map/buildings/background/house_roof_depth_03/house_roof_layer_2",this.tileset,0,0),this.house2RoofLayer.setDepth(3),this.houseRoofLayer=this.map.createLayer("map/buildings/background/house_roof_depth_03/house_roof_layer_1",this.tileset,0,0),this.houseRoofLayer.setDepth(3),this.towerTop1Layer=this.map.createLayer("map/castle/tower/tower_top_depth_01",this.tileset,0,0),this.towerTop1Layer.setDepth(1),this.towerTop2Layer=this.map.createLayer("map/castle/tower/tower_top_depth_04",this.tileset,0,0),this.towerTop2Layer.setDepth(4),this.churchRoofLayer=this.map.createLayer("map/buildings/background/church_depth_03/church_roof_03",this.tileset,0,0),this.churchRoofLayer.setDepth(1),this.castleRoofLayer=this.map.createLayer("map/castle/castle/castle_roof_depth_02",this.tileset,0,0),this.castleRoofLayer.setDepth(2),this.miscTop1Layer=this.map.createLayer("map/environment_objects/tree_01",this.tileset,0,0),this.miscTop1Layer.setDepth(1),this.miscTop2Layer=this.map.createLayer("map/environment_objects/tree_top_04",this.tileset,0,0),this.miscTop2Layer.setDepth(4),this.collisionLayer=this.map.createLayer("map/environment_collision/collide_depth_02",this.tileset,0,0),this.collisionLayer.setDepth(2),this.collisionLayer.setVisible(!1);let e,t=window.localStorage.getItem(a.CURRENT);e=null!==t?t:h.LEVEL_01,e===h.LEVEL_01?(this.candyLayer=this.map.createLayer("map/collectables/candies_level1_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level1",this.tileset,0,0)):e===h.LEVEL_02?(this.candyLayer=this.map.createLayer("map/collectables/candies_level2_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level2",this.tileset,0,0)):e===h.LEVEL_03?(this.candyLayer=this.map.createLayer("map/collectables/candies_level3_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level3",this.tileset,0,0)):e===h.LEVEL_04?(this.candyLayer=this.map.createLayer("map/collectables/candies_level4_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level4",this.tileset,0,0)):(this.candyLayer=this.map.createLayer("map/collectables/candies_level1_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level1",this.tileset,0,0)),this.candyLayer.setDepth(2),this.candyLayer.setVisible(!1),this.diverLayer.setDepth(2),this.diverLayer.setVisible(!0),this.goalLayer=this.map.createLayer("map/goal/goal_depth_02",this.tileset,0,0),this.goalLayer.setDepth(2),this.goalLayer.setVisible(!0)}createSpineObject(e,t,i,s,a,h){let l=this.add.spine(i,s,t,e,!0);return l.scaleX=a,l.scaleY=h,l}initializeAnimationsState(e,t){const i=e.getCurrentAnimation().name;e.getAnimationList().forEach(((e,s)=>{t.push(e),e===i&&(this.trufflesAnimationIndex=s)}))}changeAnimation(e,t,i){const s=t[i];e.play(s,!0)}trufflesAABB(e){var t=!1;return this.player.getX()-this.tileSize/2<e.x+e.scaleX*e.width&&this.player.getX()+this.tileSize/2>e.x&&this.player.getY()-this.tileSize<e.y+e.scaleY*e.height&&this.player.getY()>e.y&&(t=!0),t}trufflesEnemyCollision(e){var t=!1;return this.map.worldToTileX(this.player.getX())!=this.map.worldToTileX(e.x)&&this.map.worldToTileX(this.player.getX())!=this.map.worldToTileX(e.x)-1||this.map.worldToTileY(this.player.getY())!=this.map.worldToTileY(e.y)||(t=!0),t}playChurchBells(e,t,i){let s=Phaser.Math.Between(0,24);12!==s&&6!==s||this.churchBells.play()}fruitAnimate(e,t,i){this.changeAnimation(this.fruit[e],this.fruitAnimationNames,2),this.time.addEvent({delay:1e3,callback:this.fruitDelete,callbackScope:this,args:[e,t,i]})}fruitDelete(e,t,i){const s=this.map.worldToTileX(this.fruit[e].x),a=this.map.worldToTileY(this.fruit[e].y);this.tile=this.candyLayer.getTileAt(s,a),this.map.removeTile(this.tile),this.fruit[e].removeFromDisplayList()}cannonballReset(e){this.cannonball[e].setPosition(this.cannonballPosX[e],this.cannonballPosY[e]=40),this.changeAnimation(this.cannonball[e],this.cannonballAnimationNames,1),this.cannonballMoving[e]=!0}cannonballMove(){for(let e=0;e<this.cannonball.length;e++)this.cannonballMoving[e]&&(this.cannonballPosY[e]+=this.cannonballSpeed,this.cannonball[e].setPosition(this.cannonballPosX[e],this.cannonballPosY[e])),this.cannonballPosY[e]>=655&&(this.time.addEvent({delay:600,callback:this.cannonballReset,callbackScope:this,args:[e]}),this.cannonballMoving[e]&&this.changeAnimation(this.cannonball[e],this.cannonballAnimationNames,2),this.cannonballMoving[e]=!1)}setRecord(e){this.newRecordTime=e}addPoints(e){e>0&&(this.collectablePoints+=e)}fetchRecordedTime(){let e=window.localStorage.getItem("time_"+this.loadCurrentLevel());null!==e?(this.bestRecordedTime=parseInt(e)||0,0===this.bestRecordedTime&&(this.bestRecordedTime=1e3)):this.bestRecordedTime=0,window.localStorage.setItem("time_"+this.loadCurrentLevel(),this.newRecordTime.toString())}fetchRecordedScore(){let e=window.localStorage.getItem("score_"+this.loadCurrentLevel());this.levelScore=null!==e&&parseInt(e)||0,this.levelScore+=this.collectablePoints,this.collectablePoints=0,window.localStorage.setItem("score_"+this.loadCurrentLevel(),this.levelScore.toString())}loadCurrentLevel(){let e=window.localStorage.getItem(a.CURRENT);return null!==e?this.player.setCurrentLevel(e):this.player.setCurrentLevel(h.LEVEL_01),window.localStorage.setItem(a.CURRENT,this.player.getCurrentLevel()),window.localStorage.setItem(a.NEXT,this.player.getNextLevel()),window.localStorage.setItem(a.CURRENT_ARTIFACT,this.player.getCurrentArtifact()),window.localStorage.setItem(a.NEXT_ARTIFACT,this.player.getNextArtifact()),this.player.getCurrentLevel()}setCurrentLevel(){let e,t=window.localStorage.getItem(a.CURRENT);return e=null!==t?t:h.LEVEL_01,this.player.getCurrentLevel()!==e&&(window.localStorage.setItem(a.CURRENT,this.player.getCurrentLevel()),window.localStorage.setItem(a.NEXT,this.player.getNextLevel()),window.localStorage.setItem(a.CURRENT_ARTIFACT,this.player.getCurrentArtifact()),window.localStorage.setItem(a.NEXT_ARTIFACT,this.player.getNextArtifact())),this.player.getCurrentLevel()}gsmUpdate(e,t){this.gameState=s.LEVEL_COMPLETE}levelComplete(){window.localStorage.setItem(a.CURRENT,h.LEVEL_03),this.backingMusic.stop(),this.scene.start("ArtiFactTwoScene")}}const re="truffles",de="idle",ce="cannonball",pe="windmill",me="dpad",ue=["orange","lemon","grape"],ye="diver",ge="soundbtn",Le="hudtimer";class Te extends Phaser.Scene{constructor(){super({key:"LEVEL_03"}),this.divers=[],this.cannonball=[],this.fruit=[],this.trufflesAnimationNames=[],this.trufflesAnimationIndex=0,this.diverAnimationNames=[],this.diverAnimationIndex=0,this.diverMove=[],this.fruitAnimationNames=[],this.fruitMarked=[],this.orangeAnimationIndex=0,this.grapeAnimationIndex=0,this.lemonAnimationIndex=0,this.dpadAnimationIndex=0,this.dpadAnimationNames=[],this.tileSize=32,this.cannonballAnimationNames=[],this.cannonballAnimationIndex=0,this.cannonballPosX=[269,525,781],this.cannonballPosY=[60,60,60],this.cannonballSpeed=2,this.cannonballMoving=[!0,!0,!0],this.collectablePoints=0,this.levelScore=0,this.newRecordTime=0,this.screenX=0,this.screenY=0}preload(e,t){this.load.image("tileset","assets/level/truffles_level_1_tileset.png"),this.load.tilemapTiledJSON("level","assets/level/truffles_level_1.json"),this.load.setPath("assets/spine/"),this.load.spine(re,"truffles/truffles_all.json","truffles/truffles_all.atlas"),this.load.spine(ye,"diver/diver.json","diver/diver.atlas"),this.load.spine(ue[0],"fruits/orange/orange.json","fruits/orange/orange.atlas"),this.load.spine(ue[1],"fruits/grape/grape.json","fruits/grape/grape.atlas"),this.load.spine(ue[2],"fruits/lemon/lemon.json","fruits/lemon/lemon.atlas"),this.load.spine(ce,"cannonball/cannonball.json","cannonball/cannonball.atlas"),this.load.spine(pe,"windmill/windmill.json","windmill/windmill.atlas"),this.load.spine(me,"dpad/DPad_02.json","dpad/DPad_02.atlas"),this.load.spine(ge,"sound/sound.json","sound/sound.atlas"),this.load.spine(Le,"timer/timer.json","timer/timer.atlas")}create(e,t){var i;let{width:a,height:h}=this.sys.game.canvas;this.screenX=a,this.screenY=h,this.player=new W(new Phaser.Math.Vector2(100,360)),this.player.setVelocityX(new Phaser.Math.Vector2(2,0)),this.player.setVelocityY(new Phaser.Math.Vector2(0,2)),this.gameState=s.PLAY,this.fetchRecordedScore(),this.fetchRecordedTime(),this.loadCurrentLevel(),this.currentScoreText=new g(this),this.currentScoreText.setShadow(3,3),this.currentScoreText.setStroke("#fff",16),this.currentScoreText.setShadow(2,2,"#333333",2,!0,!0),this.elapsedTimeText=new g(this),this.elapsedTimeText.setShadow(3,3),this.elapsedTimeText.setStroke("#fff",16),this.elapsedTimeText.setShadow(2,2,"#333333",2,!0,!0),this.recordTimeText=new g(this),this.recordTimeText.setShadow(3,3),this.recordTimeText.setStroke("#fff",16),this.recordTimeText.setShadow(2,2,"#333333",2,!0,!0),this.hudtimer=this.createSpineObject(de,Le,.67*this.screenX,.001*this.screenY,1,1).setDepth(5).setScale(.75,.75);let l=this.hudtimer.getAnimationList();this.hudtimer.play(l[1],!0),this.time.addEvent({delay:500,loop:!0,callback:this.fetchRecordedScore,callbackScope:this}),this.setupMap();var n=this.map.width,c=this.map.height;this.backingMusic=this.sound.add("level_backing_track",{loop:!0}),this.backingMusic.play(),this.churchBells=this.sound.add("church_bells",{volume:.5}),this.time.addEvent({delay:6e3,loop:!0,callback:this.playChurchBells,callbackScope:this}),this.truffles=this.createSpineObject(de,re,this.player.getX(),this.player.getY(),this.player.getScale(),this.player.getScale()),this.truffles.setDepth(2),this.initializeAnimationsState(this.truffles,this.trufflesAnimationNames);for(let e=0;e<c;e++)for(let t=0;t<n;t++){var p=this.diverLayer.getTileAt(t,e);null!=p&&p.index===r.START&&(this.divers.push(this.createSpineObject(d.WALK_DOWN,ye,t*this.tileSize,e*this.tileSize+(this.tileSize-1),r.SCALE,r.SCALE)),this.diverMove.push(r.SPEED))}for(let e=0;e<this.divers.length;e++)this.initializeAnimationsState(this.divers[e],this.diverAnimationNames),this.divers[e].setDepth(2);this.cannonball.push(this.createSpineObject(de,ce,this.cannonballPosX[0],this.cannonballPosY[0],1.2,1.2)),this.cannonball.push(this.createSpineObject(de,ce,this.cannonballPosX[1],this.cannonballPosY[1],1.2,1.2)),this.cannonball.push(this.createSpineObject(de,ce,this.cannonballPosX[2],this.cannonballPosY[2],1.2,1.2));for(let e=0;e<this.cannonball.length;e++)this.cannonball[e].setDepth(2),this.initializeAnimationsState(this.cannonball[e],this.cannonballAnimationNames),this.cannonball[e].setDepth(0);this.windmill=this.createSpineObject(de,pe,50,0,1,1),this.windmill.setDepth(1),this.cursors=this.input.keyboard.createCursorKeys(),this.keys=this.input.keyboard.addKeys("W,A,S,D"),this.input.addPointer(2),this.dpad=this.createSpineObject(de,me,1180,630,1,1).setScale(.9).setDepth(5);let m=this.dpad.getBoneList(),u=this.dpad.getAnimationList();for(var y=0;y<m.length;y++){let e=this.dpad.findBone(m[y]),t=this.add.circle(e.worldX,720-e.worldY,15,0,0);t.bone=e.data.name,t.setDepth(5),t.setInteractive(),t.on("pointerdown",(function(e){let t=this.bone;switch(t){case"Up":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad up");break;case"Down":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad down");break;case"Left":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad left");break;case"Right":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad right");break;case"LeftDown":case"LeftUp":case"RightDown":case"RightUp":case"Static":this.dpadAnimationIndex=u.indexOf(t);break;default:this.dpadAnimationIndex=u.indexOf("Static")}})),t.on("pointerup",(function(){this.dpadAnimationIndex=u.indexOf("Static")}))}for(let e=0;e<c;e++)for(let t=0;t<n;t++)p=this.candyLayer.getTileAt(t,e),null!=p&&(p.index===o.ORANGE_TILE?(this.fruit.push(this.createSpineObject(de,ue[0],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)):p.index===o.LEMON_TILE?(this.fruit.push(this.createSpineObject(de,ue[1],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)):p.index===o.GRAPE_TILE&&(this.fruit.push(this.createSpineObject(de,ue[2],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)));for(let e=0;e<this.fruit.length;e++)this.initializeAnimationsState(this.fruit[e],this.fruitAnimationNames);this.soundbtn=this.createSpineObject(de,ge,.001*this.screenX,.001*this.screenY,1,1).setScale(.8,.8).setDepth(5).setInteractive();let L=this.soundbtn.getAnimationList(),T=(window.localStorage.getItem("soundState"),!0);"false"===window.localStorage.getItem("soundState")&&(this.game.sound.mute=!0,this.soundbtn.play(L[1],!0)),this.soundbtn.on("pointerdown",(()=>1==T?(T=!1,this.soundbtn.play(L[1],!0),window.localStorage.setItem("soundState",T.toString()),void(this.game.sound.mute=!0)):0==T?(T=!0,this.game.sound.mute=!1,this.soundbtn.play(L[0],!0),void window.localStorage.setItem("soundState",T.toString())):void 0)),this.playerState=new U(this,this.truffles,0,0),null===(i=this.playerState.getState())||void 0===i||i.enter(0,0,this.player),this.player.setState(this.playerState)}update(e,t){var i;if(this.setCurrentLevel(),this.gameState===s.PLAY?this.elapsedLevelTime=e:this.gameState===s.LEVEL_COMPLETE&&(Math.round(.001*this.elapsedLevelTime)<=this.bestRecordedTime?(this.setRecord(Math.round(.001*this.elapsedLevelTime)),this.fetchRecordedTime()):this.newRecordTime=this.bestRecordedTime,this.time.addEvent({delay:6e3,loop:!0,callback:this.levelComplete,callbackScope:this})),this.cannonballMove(),this.trufflesAnimationNames.length,Phaser.Input.Keyboard.JustDown(this.cursors.right)?this.player.getState().handleInput(c.WALK_RIGHT,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.left)?this.player.getState().handleInput(c.WALK_LEFT,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.up)?this.player.getState().handleInput(c.WALK_UP,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.down)?this.player.getState().handleInput(c.WALK_DOWN,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.keys.D)?(console.log("D"),this.player.getState().handleInput(c.WALK_RIGHT,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.A)?(console.log("A"),this.player.getState().handleInput(c.WALK_LEFT,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.W)?(console.log("W"),this.player.getState().handleInput(c.WALK_UP,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.S)&&(console.log("S"),this.player.getState().handleInput(c.WALK_DOWN,e,t,this.player)),this.player.getMove()){if(this.cursors.right.isDown){let i=this.map.worldToTileX(this.player.getX()-this.tileSize/2),s=this.map.worldToTileY(this.player.getY());this.tile=this.collisionLayer.getTileAt(i+1,s),null==this.tile&&(this.player.moveRight(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.left.isDown){let i=this.map.worldToTileX(this.player.getX()+this.tileSize/2),s=this.map.worldToTileY(this.player.getY());this.tile=this.collisionLayer.getTileAt(i-1,s),null==this.tile&&(this.player.moveLeft(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.up.isDown){let i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()+this.tileSize/4);this.tile=this.collisionLayer.getTileAt(i,s-1),null==this.tile&&(this.player.moveUp(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.down.isDown){let i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()+this.player.getVelocityY().y);this.tile=this.collisionLayer.getTileAt(i,s),null==this.tile&&(this.player.moveDown(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.down.isDown||this.cursors.up.isDown||this.cursors.left.isDown||this.cursors.right.isDown)for(let i=0;i<this.fruit.length;i++)!this.fruitMarked[i]&&this.trufflesAABB(this.fruit[i])&&(console.log("Fruit Collision "+i),this.changeAnimation(this.fruit[i],this.fruitAnimationNames,1),this.time.addEvent({delay:480,callback:this.fruitAnimate,callbackScope:this,args:[i,e,t]}),this.fruitMarked[i]=!0,this.addPoints(250),this.player.getState().handleInput(c.EATING,e,t,this.player));else this.player.getState().handleInput(c.IDLE,e,t,this.player)}for(let i=0;i<this.divers.length;i++)this.trufflesEnemyCollision(this.divers[i])&&(this.player.getState().handleInput(c.EXPIRED,e,t,this.player),this.addPoints(-150));for(let e=0;e<this.divers.length;e++){this.divers[e].y+=this.diverMove[e];const t=this.map.worldToTileX(this.divers[e].x),i=this.map.worldToTileY(this.divers[e].y);this.tile=this.diverLayer.getTileAt(t,i),this.tile.index==r.START?(this.diverMove[e]=r.SPEED,this.divers[e].play(d.WALK_DOWN,!0)):this.tile.index==r.END&&(this.diverMove[e]=-r.SPEED,this.divers[e].play(d.WALK_UP,!0))}for(let i=0;i<this.cannonball.length;i++)this.trufflesAABB(this.cannonball[i])&&(this.player.getState().handleInput(c.EXPIRED,e,t,this.player),this.addPoints(-150));null===(i=this.player.getState().getState())||void 0===i||i.update(e,t,this.player),this.currentScoreText.setPosition(.9*this.screenX,.04*this.screenY),this.currentScoreText.update(),this.currentScoreText.setText(" "+this.levelScore+" "),this.currentScoreText.setDepth(10),this.elapsedTimeText.setPosition(.75*this.screenX,.04*this.screenY),this.elapsedTimeText.update(),this.elapsedTimeText.setText(" "+Math.round(.001*this.elapsedLevelTime)+" "),this.elapsedTimeText.setDepth(10),this.recordTimeText.setPosition(.55*this.screenX,.04*this.screenY),this.recordTimeText.update(),this.recordTimeText.setText(" "+this.bestRecordedTime+" "),this.recordTimeText.setDepth(10)}setupMap(){this.map=this.make.tilemap({key:"level",tileWidth:this.tileSize,tileHeight:this.tileSize}),this.tileset=this.map.addTilesetImage("truffles_level_1_tileset","tileset"),this.waterLayer=this.map.createLayer("map/water/water_depth_00",this.tileset,0,0),this.waterLayer.setDepth(0),this.groundLayer=this.map.createLayer("map/ground/ground_depth_00",this.tileset,0,0),this.groundLayer.setDepth(0),this.ground2Layer=this.map.createLayer("map/shadow/shadow_depth_01",this.tileset,0,0),this.ground2Layer.setDepth(1),this.house2Layer=this.map.createLayer("map/buildings/foreground/house_depth_01/house_layer_2",this.tileset,0,0),this.house2Layer.setDepth(1),this.house1Layer=this.map.createLayer("map/buildings/foreground/house_depth_01/house_layer_1",this.tileset,0,0),this.house1Layer.setDepth(1),this.wall1Layer=this.map.createLayer("map/castle/walls/walls_depth_01",this.tileset,0,0),this.wall1Layer.setDepth(1),this.wall2Layer=this.map.createLayer("map/castle/walls/walls_depth_03",this.tileset,0,0),this.wall2Layer.setDepth(3),this.churchLayer=this.map.createLayer("map/buildings/foreground/church_depth_01/church_01",this.tileset,0,0),this.churchLayer.setDepth(1),this.castleLayer=this.map.createLayer("map/castle/castle/castle_depth_01",this.tileset,0,0),this.castleLayer.setDepth(1),this.miscLayer=this.map.createLayer("map/environment_objects/miscellaneous_depth_01",this.tileset,0,0),this.miscLayer.setDepth(1),this.wallTop1Layer=this.map.createLayer("map/castle/walls/wall_top_depth_01",this.tileset,0,0),this.wallTop1Layer.setDepth(1),this.wallTop2Layer=this.map.createLayer("map/castle/walls/wall_top_depth_04",this.tileset,0,0),this.wallTop2Layer.setDepth(4),this.house2RoofLayer=this.map.createLayer("map/buildings/background/house_roof_depth_03/house_roof_layer_2",this.tileset,0,0),this.house2RoofLayer.setDepth(3),this.houseRoofLayer=this.map.createLayer("map/buildings/background/house_roof_depth_03/house_roof_layer_1",this.tileset,0,0),this.houseRoofLayer.setDepth(3),this.towerTop1Layer=this.map.createLayer("map/castle/tower/tower_top_depth_01",this.tileset,0,0),this.towerTop1Layer.setDepth(1),this.towerTop2Layer=this.map.createLayer("map/castle/tower/tower_top_depth_04",this.tileset,0,0),this.towerTop2Layer.setDepth(4),this.churchRoofLayer=this.map.createLayer("map/buildings/background/church_depth_03/church_roof_03",this.tileset,0,0),this.churchRoofLayer.setDepth(1),this.castleRoofLayer=this.map.createLayer("map/castle/castle/castle_roof_depth_02",this.tileset,0,0),this.castleRoofLayer.setDepth(2),this.miscTop1Layer=this.map.createLayer("map/environment_objects/tree_01",this.tileset,0,0),this.miscTop1Layer.setDepth(1),this.miscTop2Layer=this.map.createLayer("map/environment_objects/tree_top_04",this.tileset,0,0),this.miscTop2Layer.setDepth(4),this.collisionLayer=this.map.createLayer("map/environment_collision/collide_depth_02",this.tileset,0,0),this.collisionLayer.setDepth(2),this.collisionLayer.setVisible(!1);let e,t=window.localStorage.getItem(a.CURRENT);e=null!==t?t:h.LEVEL_01,e===h.LEVEL_01?(this.candyLayer=this.map.createLayer("map/collectables/candies_level1_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level1",this.tileset,0,0)):e===h.LEVEL_02?(this.candyLayer=this.map.createLayer("map/collectables/candies_level2_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level2",this.tileset,0,0)):e===h.LEVEL_03?(this.candyLayer=this.map.createLayer("map/collectables/candies_level3_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level3",this.tileset,0,0)):e===h.LEVEL_04?(this.candyLayer=this.map.createLayer("map/collectables/candies_level4_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level4",this.tileset,0,0)):(this.candyLayer=this.map.createLayer("map/collectables/candies_level1_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level1",this.tileset,0,0)),this.candyLayer.setDepth(2),this.candyLayer.setVisible(!1),this.diverLayer.setDepth(2),this.diverLayer.setVisible(!0),this.goalLayer=this.map.createLayer("map/goal/goal_depth_02",this.tileset,0,0),this.goalLayer.setDepth(2),this.goalLayer.setVisible(!0)}createSpineObject(e,t,i,s,a,h){let l=this.add.spine(i,s,t,e,!0);return l.scaleX=a,l.scaleY=h,l}initializeAnimationsState(e,t){const i=e.getCurrentAnimation().name;e.getAnimationList().forEach(((e,s)=>{t.push(e),e===i&&(this.trufflesAnimationIndex=s)}))}changeAnimation(e,t,i){const s=t[i];e.play(s,!0)}trufflesAABB(e){var t=!1;return this.player.getX()-this.tileSize/2<e.x+e.scaleX*e.width&&this.player.getX()+this.tileSize/2>e.x&&this.player.getY()-this.tileSize<e.y+e.scaleY*e.height&&this.player.getY()>e.y&&(t=!0),t}trufflesEnemyCollision(e){var t=!1;return this.map.worldToTileX(this.player.getX())!=this.map.worldToTileX(e.x)&&this.map.worldToTileX(this.player.getX())!=this.map.worldToTileX(e.x)-1||this.map.worldToTileY(this.player.getY())!=this.map.worldToTileY(e.y)||(t=!0),t}playChurchBells(e,t,i){let s=Phaser.Math.Between(0,24);12!==s&&6!==s||this.churchBells.play()}fruitAnimate(e,t,i){this.changeAnimation(this.fruit[e],this.fruitAnimationNames,2),this.time.addEvent({delay:1e3,callback:this.fruitDelete,callbackScope:this,args:[e,t,i]})}fruitDelete(e,t,i){const s=this.map.worldToTileX(this.fruit[e].x),a=this.map.worldToTileY(this.fruit[e].y);this.tile=this.candyLayer.getTileAt(s,a),this.map.removeTile(this.tile),this.fruit[e].removeFromDisplayList()}cannonballReset(e){this.cannonball[e].setPosition(this.cannonballPosX[e],this.cannonballPosY[e]=40),this.changeAnimation(this.cannonball[e],this.cannonballAnimationNames,1),this.cannonballMoving[e]=!0}cannonballMove(){for(let e=0;e<this.cannonball.length;e++)this.cannonballMoving[e]&&(this.cannonballPosY[e]+=this.cannonballSpeed,this.cannonball[e].setPosition(this.cannonballPosX[e],this.cannonballPosY[e])),this.cannonballPosY[e]>=655&&(this.time.addEvent({delay:600,callback:this.cannonballReset,callbackScope:this,args:[e]}),this.cannonballMoving[e]&&this.changeAnimation(this.cannonball[e],this.cannonballAnimationNames,2),this.cannonballMoving[e]=!1)}setRecord(e){this.newRecordTime=e}addPoints(e){e>0&&(this.collectablePoints+=e)}fetchRecordedTime(){let e=window.localStorage.getItem("time_"+this.loadCurrentLevel());null!==e?(this.bestRecordedTime=parseInt(e)||0,0===this.bestRecordedTime&&(this.bestRecordedTime=1e3)):this.bestRecordedTime=0,window.localStorage.setItem("time_"+this.loadCurrentLevel(),this.newRecordTime.toString())}fetchRecordedScore(){let e=window.localStorage.getItem("score_"+this.loadCurrentLevel());this.levelScore=null!==e&&parseInt(e)||0,this.levelScore+=this.collectablePoints,this.collectablePoints=0,window.localStorage.setItem("score_"+this.loadCurrentLevel(),this.levelScore.toString())}loadCurrentLevel(){let e=window.localStorage.getItem(a.CURRENT);return null!==e?this.player.setCurrentLevel(e):this.player.setCurrentLevel(h.LEVEL_01),window.localStorage.setItem(a.CURRENT,this.player.getCurrentLevel()),window.localStorage.setItem(a.NEXT,this.player.getNextLevel()),window.localStorage.setItem(a.CURRENT_ARTIFACT,this.player.getCurrentArtifact()),window.localStorage.setItem(a.NEXT_ARTIFACT,this.player.getNextArtifact()),this.player.getCurrentLevel()}setCurrentLevel(){let e,t=window.localStorage.getItem(a.CURRENT);return e=null!==t?t:h.LEVEL_01,this.player.getCurrentLevel()!==e&&(window.localStorage.setItem(a.CURRENT,this.player.getCurrentLevel()),window.localStorage.setItem(a.NEXT,this.player.getNextLevel()),window.localStorage.setItem(a.CURRENT_ARTIFACT,this.player.getCurrentArtifact()),window.localStorage.setItem(a.NEXT_ARTIFACT,this.player.getNextArtifact())),this.player.getCurrentLevel()}gsmUpdate(e,t){this.gameState=s.LEVEL_COMPLETE}levelComplete(){window.localStorage.setItem(a.CURRENT,h.LEVEL_03),this.backingMusic.stop(),this.scene.start("ArtiFactThreeScene")}}const _e="truffles",we="idle",Se="cannonball",ve="windmill",fe="dpad",be=["orange","lemon","grape"],Ee="diver",Ae="soundbtn",Ie="hudtimer";class De extends Phaser.Scene{constructor(){super({key:"LEVEL_04"}),this.divers=[],this.cannonball=[],this.fruit=[],this.trufflesAnimationNames=[],this.trufflesAnimationIndex=0,this.diverAnimationNames=[],this.diverAnimationIndex=0,this.diverMove=[],this.fruitAnimationNames=[],this.fruitMarked=[],this.orangeAnimationIndex=0,this.grapeAnimationIndex=0,this.lemonAnimationIndex=0,this.dpadAnimationIndex=0,this.dpadAnimationNames=[],this.tileSize=32,this.cannonballAnimationNames=[],this.cannonballAnimationIndex=0,this.cannonballPosX=[269,525,781],this.cannonballPosY=[60,60,60],this.cannonballSpeed=2,this.cannonballMoving=[!0,!0,!0],this.collectablePoints=0,this.levelScore=0,this.newRecordTime=0,this.screenX=0,this.screenY=0}preload(e,t){this.load.image("tileset","assets/level/truffles_level_1_tileset.png"),this.load.tilemapTiledJSON("level","assets/level/truffles_level_1.json"),this.load.setPath("assets/spine/"),this.load.spine(_e,"truffles/truffles_all.json","truffles/truffles_all.atlas"),this.load.spine(Ee,"diver/diver.json","diver/diver.atlas"),this.load.spine(be[0],"fruits/orange/orange.json","fruits/orange/orange.atlas"),this.load.spine(be[1],"fruits/grape/grape.json","fruits/grape/grape.atlas"),this.load.spine(be[2],"fruits/lemon/lemon.json","fruits/lemon/lemon.atlas"),this.load.spine(Se,"cannonball/cannonball.json","cannonball/cannonball.atlas"),this.load.spine(ve,"windmill/windmill.json","windmill/windmill.atlas"),this.load.spine(fe,"dpad/DPad_02.json","dpad/DPad_02.atlas"),this.load.spine(Ae,"sound/sound.json","sound/sound.atlas"),this.load.spine(Ie,"timer/timer.json","timer/timer.atlas")}create(e,t){var i;let{width:a,height:h}=this.sys.game.canvas;this.screenX=a,this.screenY=h,this.player=new W(new Phaser.Math.Vector2(100,360)),this.player.setVelocityX(new Phaser.Math.Vector2(2,0)),this.player.setVelocityY(new Phaser.Math.Vector2(0,2)),this.gameState=s.PLAY,this.fetchRecordedScore(),this.fetchRecordedTime(),this.loadCurrentLevel(),this.currentScoreText=new g(this),this.currentScoreText.setShadow(3,3),this.currentScoreText.setStroke("#fff",16),this.currentScoreText.setShadow(2,2,"#333333",2,!0,!0),this.elapsedTimeText=new g(this),this.elapsedTimeText.setShadow(3,3),this.elapsedTimeText.setStroke("#fff",16),this.elapsedTimeText.setShadow(2,2,"#333333",2,!0,!0),this.recordTimeText=new g(this),this.recordTimeText.setShadow(3,3),this.recordTimeText.setStroke("#fff",16),this.recordTimeText.setShadow(2,2,"#333333",2,!0,!0),this.hudtimer=this.createSpineObject(we,Ie,.67*this.screenX,.001*this.screenY,1,1).setDepth(5).setScale(.75,.75);let l=this.hudtimer.getAnimationList();this.hudtimer.play(l[1],!0),this.time.addEvent({delay:500,loop:!0,callback:this.fetchRecordedScore,callbackScope:this}),this.setupMap();var n=this.map.width,c=this.map.height;this.backingMusic=this.sound.add("level_backing_track",{loop:!0}),this.backingMusic.play(),this.churchBells=this.sound.add("church_bells",{volume:.5}),this.time.addEvent({delay:6e3,loop:!0,callback:this.playChurchBells,callbackScope:this}),this.truffles=this.createSpineObject(we,_e,this.player.getX(),this.player.getY(),this.player.getScale(),this.player.getScale()),this.truffles.setDepth(2),this.initializeAnimationsState(this.truffles,this.trufflesAnimationNames);for(let e=0;e<c;e++)for(let t=0;t<n;t++){var p=this.diverLayer.getTileAt(t,e);null!=p&&p.index===r.START&&(this.divers.push(this.createSpineObject(d.WALK_DOWN,Ee,t*this.tileSize,e*this.tileSize+(this.tileSize-1),r.SCALE,r.SCALE)),this.diverMove.push(r.SPEED))}for(let e=0;e<this.divers.length;e++)this.initializeAnimationsState(this.divers[e],this.diverAnimationNames),this.divers[e].setDepth(2);this.cannonball.push(this.createSpineObject(we,Se,this.cannonballPosX[0],this.cannonballPosY[0],1.2,1.2)),this.cannonball.push(this.createSpineObject(we,Se,this.cannonballPosX[1],this.cannonballPosY[1],1.2,1.2)),this.cannonball.push(this.createSpineObject(we,Se,this.cannonballPosX[2],this.cannonballPosY[2],1.2,1.2));for(let e=0;e<this.cannonball.length;e++)this.cannonball[e].setDepth(2),this.initializeAnimationsState(this.cannonball[e],this.cannonballAnimationNames),this.cannonball[e].setDepth(0);this.windmill=this.createSpineObject(we,ve,50,0,1,1),this.windmill.setDepth(1),this.cursors=this.input.keyboard.createCursorKeys(),this.keys=this.input.keyboard.addKeys("W,A,S,D"),this.input.addPointer(2),this.dpad=this.createSpineObject(we,fe,1180,630,1,1).setScale(.9).setDepth(5);let m=this.dpad.getBoneList(),u=this.dpad.getAnimationList();for(var y=0;y<m.length;y++){let e=this.dpad.findBone(m[y]),t=this.add.circle(e.worldX,720-e.worldY,15,0,0);t.bone=e.data.name,t.setDepth(5),t.setInteractive(),t.on("pointerdown",(function(e){let t=this.bone;switch(t){case"Up":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad up");break;case"Down":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad down");break;case"Left":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad left");break;case"Right":this.dpadAnimationIndex=u.indexOf(t),console.log("dpad right");break;case"LeftDown":case"LeftUp":case"RightDown":case"RightUp":case"Static":this.dpadAnimationIndex=u.indexOf(t);break;default:this.dpadAnimationIndex=u.indexOf("Static")}})),t.on("pointerup",(function(){this.dpadAnimationIndex=u.indexOf("Static")}))}for(let e=0;e<c;e++)for(let t=0;t<n;t++)p=this.candyLayer.getTileAt(t,e),null!=p&&(p.index===o.ORANGE_TILE?(this.fruit.push(this.createSpineObject(we,be[0],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)):p.index===o.LEMON_TILE?(this.fruit.push(this.createSpineObject(we,be[1],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)):p.index===o.GRAPE_TILE&&(this.fruit.push(this.createSpineObject(we,be[2],t*this.tileSize,e*this.tileSize,.7,.7)),this.fruitMarked.push(!1)));for(let e=0;e<this.fruit.length;e++)this.initializeAnimationsState(this.fruit[e],this.fruitAnimationNames);this.soundbtn=this.createSpineObject(we,Ae,.001*this.screenX,.001*this.screenY,1,1).setScale(.8,.8).setDepth(5).setInteractive();let L=this.soundbtn.getAnimationList(),T=(window.localStorage.getItem("soundState"),!0);"false"===window.localStorage.getItem("soundState")&&(this.game.sound.mute=!0,this.soundbtn.play(L[1],!0)),this.soundbtn.on("pointerdown",(()=>1==T?(T=!1,this.soundbtn.play(L[1],!0),window.localStorage.setItem("soundState",T.toString()),void(this.game.sound.mute=!0)):0==T?(T=!0,this.game.sound.mute=!1,this.soundbtn.play(L[0],!0),void window.localStorage.setItem("soundState",T.toString())):void 0)),this.playerState=new U(this,this.truffles,0,0),null===(i=this.playerState.getState())||void 0===i||i.enter(0,0,this.player),this.player.setState(this.playerState)}update(e,t){var i;if(this.setCurrentLevel(),this.gameState===s.PLAY?this.elapsedLevelTime=e:this.gameState===s.LEVEL_COMPLETE&&(Math.round(.001*this.elapsedLevelTime)<=this.bestRecordedTime?(this.setRecord(Math.round(.001*this.elapsedLevelTime)),this.fetchRecordedTime()):this.newRecordTime=this.bestRecordedTime,this.time.addEvent({delay:6e3,loop:!0,callback:this.levelComplete,callbackScope:this})),this.cannonballMove(),this.trufflesAnimationNames.length,Phaser.Input.Keyboard.JustDown(this.cursors.right)?this.player.getState().handleInput(c.WALK_RIGHT,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.left)?this.player.getState().handleInput(c.WALK_LEFT,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.up)?this.player.getState().handleInput(c.WALK_UP,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.cursors.down)?this.player.getState().handleInput(c.WALK_DOWN,e,t,this.player):Phaser.Input.Keyboard.JustDown(this.keys.D)?(console.log("D"),this.player.getState().handleInput(c.WALK_RIGHT,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.A)?(console.log("A"),this.player.getState().handleInput(c.WALK_LEFT,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.W)?(console.log("W"),this.player.getState().handleInput(c.WALK_UP,e,t,this.player)):Phaser.Input.Keyboard.JustDown(this.keys.S)&&(console.log("S"),this.player.getState().handleInput(c.WALK_DOWN,e,t,this.player)),this.player.getMove()){if(this.cursors.right.isDown){let i=this.map.worldToTileX(this.player.getX()-this.tileSize/2),s=this.map.worldToTileY(this.player.getY());this.tile=this.collisionLayer.getTileAt(i+1,s),null==this.tile&&(this.player.moveRight(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.left.isDown){let i=this.map.worldToTileX(this.player.getX()+this.tileSize/2),s=this.map.worldToTileY(this.player.getY());this.tile=this.collisionLayer.getTileAt(i-1,s),null==this.tile&&(this.player.moveLeft(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.up.isDown){let i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()+this.tileSize/4);this.tile=this.collisionLayer.getTileAt(i,s-1),null==this.tile&&(this.player.moveUp(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.down.isDown){let i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()+this.player.getVelocityY().y);this.tile=this.collisionLayer.getTileAt(i,s),null==this.tile&&(this.player.moveDown(),this.truffles.setPosition(this.player.getX(),this.player.getY())),i=this.map.worldToTileX(this.player.getX()),s=this.map.worldToTileY(this.player.getY()),this.tile=this.goalLayer.getTileAt(i,s),null!==this.tile&&this.tile.index===n.TILE&&(this.player.getState().handleInput(c.REACHED_GOAL,e,t,this.player),this.gsmUpdate(e,t))}if(this.cursors.down.isDown||this.cursors.up.isDown||this.cursors.left.isDown||this.cursors.right.isDown)for(let i=0;i<this.fruit.length;i++)!this.fruitMarked[i]&&this.trufflesAABB(this.fruit[i])&&(console.log("Fruit Collision "+i),this.changeAnimation(this.fruit[i],this.fruitAnimationNames,1),this.time.addEvent({delay:480,callback:this.fruitAnimate,callbackScope:this,args:[i,e,t]}),this.fruitMarked[i]=!0,this.addPoints(250),this.player.getState().handleInput(c.EATING,e,t,this.player));else this.player.getState().handleInput(c.IDLE,e,t,this.player)}for(let i=0;i<this.divers.length;i++)this.trufflesEnemyCollision(this.divers[i])&&(this.player.getState().handleInput(c.EXPIRED,e,t,this.player),this.addPoints(-150));for(let e=0;e<this.divers.length;e++){this.divers[e].y+=this.diverMove[e];const t=this.map.worldToTileX(this.divers[e].x),i=this.map.worldToTileY(this.divers[e].y);this.tile=this.diverLayer.getTileAt(t,i),this.tile.index==r.START?(this.diverMove[e]=r.SPEED,this.divers[e].play(d.WALK_DOWN,!0)):this.tile.index==r.END&&(this.diverMove[e]=-r.SPEED,this.divers[e].play(d.WALK_UP,!0))}for(let i=0;i<this.cannonball.length;i++)this.trufflesAABB(this.cannonball[i])&&(this.player.getState().handleInput(c.EXPIRED,e,t,this.player),this.addPoints(-150));null===(i=this.player.getState().getState())||void 0===i||i.update(e,t,this.player),this.currentScoreText.setPosition(.9*this.screenX,.04*this.screenY),this.currentScoreText.update(),this.currentScoreText.setText(" "+this.levelScore+" "),this.currentScoreText.setDepth(10),this.elapsedTimeText.setPosition(.75*this.screenX,.04*this.screenY),this.elapsedTimeText.update(),this.elapsedTimeText.setText(" "+Math.round(.001*this.elapsedLevelTime)+" "),this.elapsedTimeText.setDepth(10),this.recordTimeText.setPosition(.55*this.screenX,.04*this.screenY),this.recordTimeText.update(),this.recordTimeText.setText(" "+this.bestRecordedTime+" "),this.recordTimeText.setDepth(10)}setupMap(){this.map=this.make.tilemap({key:"level",tileWidth:this.tileSize,tileHeight:this.tileSize}),this.tileset=this.map.addTilesetImage("truffles_level_1_tileset","tileset"),this.waterLayer=this.map.createLayer("map/water/water_depth_00",this.tileset,0,0),this.waterLayer.setDepth(0),this.groundLayer=this.map.createLayer("map/ground/ground_depth_00",this.tileset,0,0),this.groundLayer.setDepth(0),this.ground2Layer=this.map.createLayer("map/shadow/shadow_depth_01",this.tileset,0,0),this.ground2Layer.setDepth(1),this.house2Layer=this.map.createLayer("map/buildings/foreground/house_depth_01/house_layer_2",this.tileset,0,0),this.house2Layer.setDepth(1),this.house1Layer=this.map.createLayer("map/buildings/foreground/house_depth_01/house_layer_1",this.tileset,0,0),this.house1Layer.setDepth(1),this.wall1Layer=this.map.createLayer("map/castle/walls/walls_depth_01",this.tileset,0,0),this.wall1Layer.setDepth(1),this.wall2Layer=this.map.createLayer("map/castle/walls/walls_depth_03",this.tileset,0,0),this.wall2Layer.setDepth(3),this.churchLayer=this.map.createLayer("map/buildings/foreground/church_depth_01/church_01",this.tileset,0,0),this.churchLayer.setDepth(1),this.castleLayer=this.map.createLayer("map/castle/castle/castle_depth_01",this.tileset,0,0),this.castleLayer.setDepth(1),this.miscLayer=this.map.createLayer("map/environment_objects/miscellaneous_depth_01",this.tileset,0,0),this.miscLayer.setDepth(1),this.wallTop1Layer=this.map.createLayer("map/castle/walls/wall_top_depth_01",this.tileset,0,0),this.wallTop1Layer.setDepth(1),this.wallTop2Layer=this.map.createLayer("map/castle/walls/wall_top_depth_04",this.tileset,0,0),this.wallTop2Layer.setDepth(4),this.house2RoofLayer=this.map.createLayer("map/buildings/background/house_roof_depth_03/house_roof_layer_2",this.tileset,0,0),this.house2RoofLayer.setDepth(3),this.houseRoofLayer=this.map.createLayer("map/buildings/background/house_roof_depth_03/house_roof_layer_1",this.tileset,0,0),this.houseRoofLayer.setDepth(3),this.towerTop1Layer=this.map.createLayer("map/castle/tower/tower_top_depth_01",this.tileset,0,0),this.towerTop1Layer.setDepth(1),this.towerTop2Layer=this.map.createLayer("map/castle/tower/tower_top_depth_04",this.tileset,0,0),this.towerTop2Layer.setDepth(4),this.churchRoofLayer=this.map.createLayer("map/buildings/background/church_depth_03/church_roof_03",this.tileset,0,0),this.churchRoofLayer.setDepth(1),this.castleRoofLayer=this.map.createLayer("map/castle/castle/castle_roof_depth_02",this.tileset,0,0),this.castleRoofLayer.setDepth(2),this.miscTop1Layer=this.map.createLayer("map/environment_objects/tree_01",this.tileset,0,0),this.miscTop1Layer.setDepth(1),this.miscTop2Layer=this.map.createLayer("map/environment_objects/tree_top_04",this.tileset,0,0),this.miscTop2Layer.setDepth(4),this.collisionLayer=this.map.createLayer("map/environment_collision/collide_depth_02",this.tileset,0,0),this.collisionLayer.setDepth(2),this.collisionLayer.setVisible(!1);let e,t=window.localStorage.getItem(a.CURRENT);e=null!==t?t:h.LEVEL_01,e===h.LEVEL_01?(this.candyLayer=this.map.createLayer("map/collectables/candies_level1_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level1",this.tileset,0,0)):e===h.LEVEL_02?(this.candyLayer=this.map.createLayer("map/collectables/candies_level2_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level2",this.tileset,0,0)):e===h.LEVEL_03?(this.candyLayer=this.map.createLayer("map/collectables/candies_level3_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level3",this.tileset,0,0)):e===h.LEVEL_04?(this.candyLayer=this.map.createLayer("map/collectables/candies_level4_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level4",this.tileset,0,0)):(this.candyLayer=this.map.createLayer("map/collectables/candies_level1_depth_02",this.tileset,0,0),this.diverLayer=this.map.createLayer("map/patrol/level1",this.tileset,0,0)),this.candyLayer.setDepth(2),this.candyLayer.setVisible(!1),this.diverLayer.setDepth(2),this.diverLayer.setVisible(!0),this.goalLayer=this.map.createLayer("map/goal/goal_depth_02",this.tileset,0,0),this.goalLayer.setDepth(2),this.goalLayer.setVisible(!0)}createSpineObject(e,t,i,s,a,h){let l=this.add.spine(i,s,t,e,!0);return l.scaleX=a,l.scaleY=h,l}initializeAnimationsState(e,t){const i=e.getCurrentAnimation().name;e.getAnimationList().forEach(((e,s)=>{t.push(e),e===i&&(this.trufflesAnimationIndex=s)}))}changeAnimation(e,t,i){const s=t[i];e.play(s,!0)}trufflesAABB(e){var t=!1;return this.player.getX()-this.tileSize/2<e.x+e.scaleX*e.width&&this.player.getX()+this.tileSize/2>e.x&&this.player.getY()-this.tileSize<e.y+e.scaleY*e.height&&this.player.getY()>e.y&&(t=!0),t}trufflesEnemyCollision(e){var t=!1;return this.map.worldToTileX(this.player.getX())!=this.map.worldToTileX(e.x)&&this.map.worldToTileX(this.player.getX())!=this.map.worldToTileX(e.x)-1||this.map.worldToTileY(this.player.getY())!=this.map.worldToTileY(e.y)||(t=!0),t}playChurchBells(e,t,i){let s=Phaser.Math.Between(0,24);12!==s&&6!==s||this.churchBells.play()}fruitAnimate(e,t,i){this.changeAnimation(this.fruit[e],this.fruitAnimationNames,2),this.time.addEvent({delay:1e3,callback:this.fruitDelete,callbackScope:this,args:[e,t,i]})}fruitDelete(e,t,i){const s=this.map.worldToTileX(this.fruit[e].x),a=this.map.worldToTileY(this.fruit[e].y);this.tile=this.candyLayer.getTileAt(s,a),this.map.removeTile(this.tile),this.fruit[e].removeFromDisplayList()}cannonballReset(e){this.cannonball[e].setPosition(this.cannonballPosX[e],this.cannonballPosY[e]=40),this.changeAnimation(this.cannonball[e],this.cannonballAnimationNames,1),this.cannonballMoving[e]=!0}cannonballMove(){for(let e=0;e<this.cannonball.length;e++)this.cannonballMoving[e]&&(this.cannonballPosY[e]+=this.cannonballSpeed,this.cannonball[e].setPosition(this.cannonballPosX[e],this.cannonballPosY[e])),this.cannonballPosY[e]>=655&&(this.time.addEvent({delay:600,callback:this.cannonballReset,callbackScope:this,args:[e]}),this.cannonballMoving[e]&&this.changeAnimation(this.cannonball[e],this.cannonballAnimationNames,2),this.cannonballMoving[e]=!1)}setRecord(e){this.newRecordTime=e}addPoints(e){e>0&&(this.collectablePoints+=e)}fetchRecordedTime(){let e=window.localStorage.getItem("time_"+this.loadCurrentLevel());null!==e?(this.bestRecordedTime=parseInt(e)||0,0===this.bestRecordedTime&&(this.bestRecordedTime=1e3)):this.bestRecordedTime=0,window.localStorage.setItem("time_"+this.loadCurrentLevel(),this.newRecordTime.toString())}fetchRecordedScore(){let e=window.localStorage.getItem("score_"+this.loadCurrentLevel());this.levelScore=null!==e&&parseInt(e)||0,this.levelScore+=this.collectablePoints,this.collectablePoints=0,window.localStorage.setItem("score_"+this.loadCurrentLevel(),this.levelScore.toString())}loadCurrentLevel(){let e=window.localStorage.getItem(a.CURRENT);return null!==e?this.player.setCurrentLevel(e):this.player.setCurrentLevel(h.LEVEL_01),window.localStorage.setItem(a.CURRENT,this.player.getCurrentLevel()),window.localStorage.setItem(a.NEXT,this.player.getNextLevel()),window.localStorage.setItem(a.CURRENT_ARTIFACT,this.player.getCurrentArtifact()),window.localStorage.setItem(a.NEXT_ARTIFACT,this.player.getNextArtifact()),this.player.getCurrentLevel()}setCurrentLevel(){let e,t=window.localStorage.getItem(a.CURRENT);return e=null!==t?t:h.LEVEL_01,this.player.getCurrentLevel()!==e&&(window.localStorage.setItem(a.CURRENT,this.player.getCurrentLevel()),window.localStorage.setItem(a.NEXT,this.player.getNextLevel()),window.localStorage.setItem(a.CURRENT_ARTIFACT,this.player.getCurrentArtifact()),window.localStorage.setItem(a.NEXT_ARTIFACT,this.player.getNextArtifact())),this.player.getCurrentLevel()}gsmUpdate(e,t){this.gameState=s.LEVEL_COMPLETE}levelComplete(){window.localStorage.setItem(a.CURRENT,h.CREDITS),this.backingMusic.stop(),this.scene.start("ArtiFactFourScene")}}const xe={type:Phaser.WEBGL,dom:{createContainer:!0},backgroundColor:"#ffffff",scale:{parent:"three_muses_game",dom:{createContainer:!0},mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1280,height:720},scene:[y,Z,oe,Te,De,u,L,T,_,w,S],plugins:{scene:[{key:"SpinePlugin",plugin:window.SpinePlugin,mapping:"spine"}]},physics:{default:"arcade",arcade:{debug:!1,gravity:{y:400}}}};window.addEventListener("load",(()=>{new Phaser.Game(xe)}))}},i={};function s(e){var a=i[e];if(void 0!==a)return a.exports;var h=i[e]={exports:{}};return t[e].call(h.exports,h,h.exports,s),h.exports}s.m=t,e=[],s.O=(t,i,a,h)=>{if(!i){var l=1/0;for(d=0;d<e.length;d++){for(var[i,a,h]=e[d],n=!0,o=0;o<i.length;o++)(!1&h||l>=h)&&Object.keys(s.O).every((e=>s.O[e](i[o])))?i.splice(o--,1):(n=!1,h<l&&(l=h));if(n){e.splice(d--,1);var r=a();void 0!==r&&(t=r)}}return t}h=h||0;for(var d=e.length;d>0&&e[d-1][2]>h;d--)e[d]=e[d-1];e[d]=[i,a,h]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var a,h,[l,n,o]=i,r=0;if(l.some((t=>0!==e[t]))){for(a in n)s.o(n,a)&&(s.m[a]=n[a]);if(o)var d=o(s)}for(t&&t(i);r<l.length;r++)h=l[r],s.o(e,h)&&e[h]&&e[h][0](),e[h]=0;return s.O(d)},i=self.webpackChunkthree_muses_project=self.webpackChunkthree_muses_project||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a=s.O(void 0,[216],(()=>s(189)));a=s.O(a)})();